"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[69033],{11303:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>g,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var a=t(58168),r=(t(96540),t(15680));const i={title:"FHIR r4 Adaptor"},o=void 0,l={unversionedId:"fhir-4",id:"fhir-4",title:"FHIR r4 Adaptor",description:"Language support for FHIR version 4. This adaptor is compatible with any FHIR R4",source:"@site/adaptors/fhir-4.md",sourceDirName:".",slug:"/fhir-4",permalink:"/adaptors/fhir-4",draft:!1,tags:[],version:"current",frontMatter:{title:"FHIR r4 Adaptor"},sidebar:"adaptors",previous:{title:"fhir developer readme",permalink:"/adaptors/packages/fhir-readme"},next:{title:"fhir-4@0.1.1",permalink:"/adaptors/packages/fhir-4-docs"}},s={},p=[{value:"About FHIR",id:"about-fhir",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Code Assist",id:"code-assist",level:2},{value:"Bundles",id:"bundles",level:2},{value:"Builder Functions",id:"builder-functions",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Cardinality",id:"cardinality",level:2},{value:"DataTypes Builders",id:"datatypes-builders",level:2},{value:"Identifiers",id:"identifiers",level:3},{value:"Codings",id:"codings",level:3},{value:"Codeable Concepts",id:"codeable-concepts",level:3},{value:"References",id:"references",level:3},{value:"Multiple Types",id:"multiple-types",level:3},{value:"Extensions",id:"extensions",level:3},{value:"System Mappings",id:"system-mappings",level:3}],u={toc:p},d="wrapper";function g(e){let{components:n,...t}=e;return(0,r.yg)(d,(0,a.A)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"Language support for FHIR version 4. This adaptor is compatible with any FHIR R4\ncompliant server."),(0,r.yg)("p",null,"The FHIR 4 adaptor is implemented in TypeScript and comes complete with full\nTypeScript definitions."),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"This adaptor is strictly only compatible with\n",(0,r.yg)("a",{parentName:"p",href:"https://www.hl7.org/fhir/R4"},"FHIR R4"),". But all versions are supported by our\n",(0,r.yg)("a",{parentName:"p",href:"/adaptors/fhir"},"generic fhir")," adaptor!")),(0,r.yg)("h2",{id:"about-fhir"},"About FHIR"),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://www.hl7.org/fhir/overview.html"},"FHIR")," stands for Fast Healthcare\nInteroperability Resources. It is a standard for representing and exchanging\nhealthcare data electronically."),(0,r.yg)("p",null,"Learn more about FHIR and\n",(0,r.yg)("a",{parentName:"p",href:"/documentation/get-started/standards#fhir-for-health-data-exchange"},"FHIR for heath data exchange"),"."),(0,r.yg)("h2",{id:"authentication"},"Authentication"),(0,r.yg)("p",null,"The FHIR standard does not directly prescribe authentication and authorization\nmethods. Instead, it provides security guidelines and leaves the choice of\nimplementation to the developers of FHIR servers and clients. See the FHIR\n",(0,r.yg)("a",{parentName:"p",href:"https://www.hl7.org/fhir/security.html"},"docs")," for the latest security-related\nrecommendations. Depending on the FHIR systems being integrated via OpenFn, you\nmight employ a Basic Auth, API key, or OAuth authentication scheme."),(0,r.yg)("p",null,"See this adaptor's\n",(0,r.yg)("a",{parentName:"p",href:"/adaptors/packages/fhir-4-configuration-schema"},"Configuration docs")," for more on\nthe required authentication parameters."),(0,r.yg)("p",null,"See platform docs on\n",(0,r.yg)("a",{parentName:"p",href:"/documentation/manage-projects/manage-credentials"},"managing credentials")," for\nhow to configure a credential in OpenFn. If working locally or if using a Raw\nJSON credential type, then your configuration will look something like this to\ndefine your target endpoint and FHIR version:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'{\n  "baseUrl": "https://hapi.fhir.org", //fhir endpoint\n  "apiPath": "baseR4" //fhir version\n}\n')),(0,r.yg)("h2",{id:"code-assist"},"Code Assist"),(0,r.yg)("p",null,"The OpenFn Inspector provides full code-assist and code-complete for all FHIR\nresource types."),(0,r.yg)("p",null,"Pressing ",(0,r.yg)("inlineCode",{parentName:"p"},"ctrl + space")," will open up the Suggestions list, which provides\ncontextual auto-completion. Use this to more easily create FHIR resources."),(0,r.yg)("p",null,"Note that code assist will only provide suggestions for commonly used\nproperties, but custom properties can also be passed directly and will be\nwritten to the new resource"),(0,r.yg)("h2",{id:"bundles"},"Bundles"),(0,r.yg)("p",null,"The FHIR-4 adaptor provides support for bundles."),(0,r.yg)("p",null,"You can create resources and add them to a bundle:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"addToBundle($.resource);\n")),(0,r.yg)("p",null,"Where ",(0,r.yg)("inlineCode",{parentName:"p"},"$.resource")," is a FHIR resource, or an array of resources, on the state\nobject."),(0,r.yg)("p",null,"This will add the resources to a bundle resource, under the ",(0,r.yg)("inlineCode",{parentName:"p"},"entry")," key, on\nstate under a key called ",(0,r.yg)("inlineCode",{parentName:"p"},"bundle"),". To save the bundle under a different key,\npass a string as the second argument:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"addToBundle($.resource, 'patients-bundle');\n")),(0,r.yg)("p",null,"Each item in the bundle will be given a ",(0,r.yg)("inlineCode",{parentName:"p"},"request")," object with the ",(0,r.yg)("inlineCode",{parentName:"p"},"PUT")," method\nand a URL. For example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"addToBundle({\n  id: 'x',\n  resourceType: 'Patient',\n});\n")),(0,r.yg)("p",null,"Will create a state object like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "bundle": {\n    "resourceType": "bundle",\n    "entry": [\n      {\n        "resource": {\n          "id": "x",\n          "resourceType": "Patient"\n        },\n        "request": {\n          "method": "PUT",\n          "url": "Patient/x"\n        }\n      }\n    ]\n  }\n}\n')),(0,r.yg)("p",null,"To send the Bundle to the FHIR server defined in ",(0,r.yg)("inlineCode",{parentName:"p"},"state.configuration.baseURL"),",\ncall ",(0,r.yg)("inlineCode",{parentName:"p"},"uploadBundle()"),"."),(0,r.yg)("p",null,"You can pass the name of a key on state to upload a specific bundle:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"uploadBundle('patients-bundle');\n")),(0,r.yg)("p",null,"Or you can pass your own bundle object in directly:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"uploadBundle($.bundle);\n")),(0,r.yg)("h2",{id:"builder-functions"},"Builder Functions"),(0,r.yg)("p",null,"The FHIR-4 adaptor provides builder functions which make it easier to define\nFHIR resources."),(0,r.yg)("p",null,"Builders provide short-hand properties and default values, reducing the\nboiler-plate needed to create FHIR resources. They also enable code-assist to be\nprovided by code editors."),(0,r.yg)("p",null,"The basic pattern is something like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"create(\n  builders.patient({\n    id: 'example',\n    identifier: [\n      {\n        value: '12345',\n        type: ['MR', 'http://terminology.hl7.org/CodeSystem/v2-0203'],\n        system: 'urn:oid:1.2.36.146.595.217.0.1',\n        period: { start: '2001-05-06' },\n      },\n    ],\n    active: true,\n    name: [\n      {\n        family: 'Chalmers',\n        given: ['Peter', 'James'],\n      },\n    ],\n    managingOrganization: 'Organization/1',\n  })\n);\n")),(0,r.yg)("h3",{id:"basic-usage"},"Basic Usage"),(0,r.yg)("p",null,"All builders are available on the ",(0,r.yg)("inlineCode",{parentName:"p"},"b")," (short for ",(0,r.yg)("inlineCode",{parentName:"p"},"builders"),") namespace within\nyour OpenFn expression."),(0,r.yg)("p",null,"Every resource in FHIR should have a corresponding builder function on the ",(0,r.yg)("inlineCode",{parentName:"p"},"b."),"\nnamespace (check the reference for details): for example, ",(0,r.yg)("inlineCode",{parentName:"p"},"b.patient()"),",\n",(0,r.yg)("inlineCode",{parentName:"p"},"b.observation()"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"b.encounter()")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"b.invoice()"),"."),(0,r.yg)("p",null,"The first argument for the builder is an object with properties corresponding to\nFHIR json:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  identifier: $.data.patientId,\n});\n")),(0,r.yg)("p",null,"Which will generate the following data structure:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "resourceType": "Patient"\n  "id": "123",\n}\n')),(0,r.yg)("p",null,"You don't have to use builder functions - you can just write our your FHIR\nstructures in-line. But the builders come with some key benefits:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"They backed by full TypeScript definitions, so you'll get validation and\ncode-assist as you type"),(0,r.yg)("li",{parentName:"ol"},"They simplify some FHIR data structures")),(0,r.yg)("p",null,"The builders are designed to take a fuzzy, relaxed definition of a FHIR resource\nand convert it to correct JSON. For example, a Reference type can be passed as a\nfully FHIR reference object, a string id, or an existing FHIR resource. The\nbuilder will figure out how to parse and map it to a Reference with reasonable\ndefaults."),(0,r.yg)("p",null,"Builders are not operations, so they don't sit at the top of your job code. You\ncan either pass them as an argument to an operation:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"create(b.patient($.data));\n")),(0,r.yg)("p",null,"Or within a callback function (like ",(0,r.yg)("inlineCode",{parentName:"p"},"fn()"),"):"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"fn(state => {\n  state.newPatient = b.patient(state.data);\n  return state;\n});\n")),(0,r.yg)("h2",{id:"cardinality"},"Cardinality"),(0,r.yg)("p",null,"Resource builders will automatically embed values into arrays where appropriate,\nsimplifying cardinality handling."),(0,r.yg)("p",null,"For example, a Patient's ",(0,r.yg)("inlineCode",{parentName:"p"},"identifier")," property contains an array of identifiers.\nBut when using a builder function, you can pass a single identifier:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  identifier: {\n    value: 'abc',\n  },\n});\n")),(0,r.yg)("p",null,"Which will be embedded into an array for you:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "resourceType": "Patient",\n  "identifier": [\n    {\n      "value": "abc"\n    }\n  ]\n}\n')),(0,r.yg)("h2",{id:"datatypes-builders"},"DataTypes Builders"),(0,r.yg)("p",null,"The builders have special handling and helpers for FHIR datatypes, like\n",(0,r.yg)("inlineCode",{parentName:"p"},"identifier")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"coding"),"."),(0,r.yg)("p",null,"Like resource builders, they exist on the ",(0,r.yg)("inlineCode",{parentName:"p"},"b.")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"builders.")," namespace. Unlike\nthe other builders, they are hand-written and not auto-generated from the spec.\nThis means they have a slightly different API."),(0,r.yg)("p",null,"The most important datatype builders are detailed below."),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"When you pass an object into a builder, internally that object will be passed to\na datatype builder."),(0,r.yg)("p",{parentName:"admonition"},"So you can either pass a reference directly:"),(0,r.yg)("pre",{parentName:"admonition"},(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  identifier: {\n    value: 'abc',\n  },\n});\n")),(0,r.yg)("p",{parentName:"admonition"},"Or use a builder explicitly:"),(0,r.yg)("pre",{parentName:"admonition"},(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  identifier: b.id('abc'),\n});\n")),(0,r.yg)("p",{parentName:"admonition"},"You may want to use a builder to pass an extension."),(0,r.yg)("pre",{parentName:"admonition"},(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  identifier: b.identifier('abc', {\n    url: 'http://hospital.example.org/fhir/StructureDefinition/identifier-issuingDepartment',\n    value: 'Emergency Department',\n  }),\n});\n"))),(0,r.yg)("h3",{id:"identifiers"},"Identifiers"),(0,r.yg)("p",null,"Use ",(0,r.yg)("inlineCode",{parentName:"p"},"b.identifier(id, ...extensions)")," or its shorthand,\n",(0,r.yg)("inlineCode",{parentName:"p"},"b.id(id, ...extensions)"),", to create an Identifier object."),(0,r.yg)("p",null,"You can pass a single string value to create an identifier without a system:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.identifier('ip_request1.1');\n")),(0,r.yg)("p",null,"More commonly, you'll pass a ",(0,r.yg)("inlineCode",{parentName:"p"},"{ value, system }")," pair:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.identifier({\n  system: 'http://moh.gov.et/fhir/hiv/identifier/MRN',\n  value: 'MRN12345671',\n});\n")),(0,r.yg)("p",null,"Any additional arguments will be treated as extensions:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.identifier(\n  {\n    system: 'http://moh.gov.et/fhir/hiv/identifier/MRN',\n    value: 'MRN12345671',\n  },\n  {\n    url: 'http://hospital.example.org/fhir/StructureDefinition/identifier-issuingDepartment',\n    valueString: 'Emergency Department',\n  },\n  {\n    url: 'http://hospital.example.org/fhir/StructureDefinition/identifier-issuedDate',\n    valueDateTime: '2023-06-15T14:30:00Z',\n  }\n);\n")),(0,r.yg)("p",null,"Resulting in the following JSON structure:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "resourceType": "Patient",\n  "identifier": [\n    {\n      "system": "http://moh.gov.et/fhir/hiv/identifier/MRN",\n      "value": "MRN12345671",\n      "extension": [\n        {\n          "url": "http://hospital.example.org/fhir/StructureDefinition/identifier-issuingDepartment",\n          "valueString": "Emergency Department"\n        },\n        {\n          "url": "http://hospital.example.org/fhir/StructureDefinition/identifier-issuedDate",\n          "valueDateTime": "2023-06-15T14:30:00Z"\n        }\n      ]\n    }\n  ]\n}\n')),(0,r.yg)("h3",{id:"codings"},"Codings"),(0,r.yg)("p",null,"Use ",(0,r.yg)("inlineCode",{parentName:"p"},"b.coding(code, system, extra)")," or its shorthand,\n",(0,r.yg)("inlineCode",{parentName:"p"},"b.c(code, system, extra)"),", to create a Coding object"),(0,r.yg)("p",null,"You can create a coding directly with the ",(0,r.yg)("inlineCode",{parentName:"p"},"coding")," builder:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.coding('MR', 'http://terminology.hl7.org/CodeSystem/v2-0203');\n// returns { code: 'MR', system: 'http://terminology.hl7.org/CodeSystem/v2-0203' }\n")),(0,r.yg)("p",null,"You can also use the shorthand form, ",(0,r.yg)("inlineCode",{parentName:"p"},"c"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.c('MR', 'http://terminology.hl7.org/CodeSystem/v2-0203', {\n  display: 'Medical record number',\n});\n// returns { code: 'MR', system: 'http://terminology.hl7.org/CodeSystem/v2-0203' }\n")),(0,r.yg)("p",null,"You can pass any extra properties to the coding to add them to the object.\nStandard FHIR properties are type-supported and code-assisted."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.c('MR', 'http://terminology.hl7.org/CodeSystem/v2-0203', {\n  display: 'Medical record number',\n});\n// returns {\n//  code: 'MR',\n//  system: 'http://terminology.hl7.org/CodeSystem/v2-0203',\n//  display: 'Medical record number' ,\n// }\n")),(0,r.yg)("h3",{id:"codeable-concepts"},"Codeable Concepts"),(0,r.yg)("p",null,"Use ",(0,r.yg)("inlineCode",{parentName:"p"},"b.concept(codings, extra)")," or its shorthand, ",(0,r.yg)("inlineCode",{parentName:"p"},"b.cc(codings, extra)"),", to\ncreate a Codeable Concept with one or more codings."),(0,r.yg)("p",null,"Pass one or more codings, as tuples or objects, and optionally extra keys to add\nto the concept:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.concept(codings, props);\n")),(0,r.yg)("p",null,"For example, to create a concept with a single coding:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.concept(['MR', 'http://terminology.hl7.org/CodeSystem/v2-0203']);\n// outputs { coding: [{ type: 'MR', system: 'http://terminology.hl7.org/CodeSystem/v2-0203' }]}\n")),(0,r.yg)("p",null,"Or for multiple codings (note the extra array!)"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.concept([\n  ['M', 'http://terminology.hl7.org/CodeSystem/v3-MaritalStatus'],\n  ['02', 'http://national-registry.example.org/marital-status'],\n]);\n")),(0,r.yg)("p",null,"You can add extra props to the concept, like text:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.concept($.codings, { text: 'Married' });\n// outputs { text: 'Married', coding: [...]} }\n")),(0,r.yg)("p",null,'Where a CodeableConcept is expected, it can be represented as a "tuple", or an\narray of two strings where the first value is the code, and the second is the\nsystem. The tuple will be expanded to a ',(0,r.yg)("inlineCode",{parentName:"p"},"{ code, system }")," Coding object."),(0,r.yg)("p",null,"For example, an Identifier's ",(0,r.yg)("inlineCode",{parentName:"p"},"type")," accepts a CodeableConcept. We can create a\npatient like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"builders.patient({\n  identifier: [\n    {\n      type: ['MR', 'http://terminology.hl7.org/CodeSystem/v2-0203'],\n    },\n  ],\n});\n")),(0,r.yg)("p",null,"Which will generate a resource like:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "resourceType": "Patient",\n  "identifier": [\n    {\n      "type": {\n        "code": "MR",\n        "system": "http://terminology.hl7.org/CodeSystem/v2-0203"\n      }\n    }\n  ]\n}\n')),(0,r.yg)("p",null,"You can also pass a concept object directly, with full type support."),(0,r.yg)("h3",{id:"references"},"References"),(0,r.yg)("p",null,"Some FHIR resources reference others. Reference types in the builders provide a\nnumber of short-hands."),(0,r.yg)("p",null,"For example, a FHIR reference looks like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'"managingOrganization": {\n  "reference": "Organization/1"\n}\n')),(0,r.yg)("p",null,"In the patient builder, we can provide this reference in a few ways."),(0,r.yg)("p",null,'You can pass the reference string directly, which will be "expanded" into a\nreference.'),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  managingOrganization: 'Organization/1',\n});\n")),(0,r.yg)("p",null,"You can pass an existing reference object (useful when mapping FHIR to FHIR)"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  managingOrganization: $.patient.managingOrganization,\n});\n")),(0,r.yg)("p",null,"Or you can pass an existing FHIR resource, if you happen to have access to the\none you want to reference:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  managingOrganization: $.myOrg,\n});\n")),(0,r.yg)("p",null,"Where supported, you can also pass an array of references."),(0,r.yg)("p",null,"You can use ",(0,r.yg)("inlineCode",{parentName:"p"},"b.reference()")," to create your own reference with the above rules\n(particularly useful when dealing with extensions which aren't typed)."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  managingOrganization: b.ref($.org), // $.org can be a string, resource or reference\n});\n")),(0,r.yg)("h3",{id:"multiple-types"},"Multiple Types"),(0,r.yg)("p",null,"Some FHIR properties are polymorphic and support multiple data types. For\nexample, a Patient's ",(0,r.yg)("inlineCode",{parentName:"p"},"deceased")," property can be of type ",(0,r.yg)("inlineCode",{parentName:"p"},"boolean")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"datetime"),"."),(0,r.yg)("p",null,"In FHIR json, this results in a type suffix being appended to the key. For\nexample:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "resourceType": "Patient",\n  "deceasedBoolean": false,\n  "deceasedDateTime": "2025-01-01"\n}\n')),(0,r.yg)("p",null,"Builder functions allow you to specify the base property name and not worry\nabout typing the key."),(0,r.yg)("p",null,"For example, these both work in a FHIR-compliant way:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  deceased: true,\n});\nb.patient({\n  deceased: '2025-01-01',\n});\n")),(0,r.yg)("p",null,"Internally, the builder will determine the type of the incoming value and\ngenerate the correct key."),(0,r.yg)("p",null,"Note that passing suffixed keys still works just fine."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.patient({\n  deceasedDateTime: '2025-01-01',\n});\n")),(0,r.yg)("h3",{id:"extensions"},"Extensions"),(0,r.yg)("p",null,"FHIR is highly extensible, and the adaptor builder APIs have many features to\nsupport this."),(0,r.yg)("p",null,"Any property can be prefixed with ",(0,r.yg)("inlineCode",{parentName:"p"},"_")," to provide an extension, e.g,,:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.identifier({ _use: 'custom use' });\n")),(0,r.yg)("p",null,"You can add an extension to any resource using the\n",(0,r.yg)("inlineCode",{parentName:"p"},"addExtension(resource, extensionUrl, extensionValue)")," builder."),(0,r.yg)("p",null,"For example, the following code:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"fn(state => {\n  const patient = b.patient({});\n\n  b.addExtension(\n    patient,\n    'http://hl7.org/fhir/StructureDefinition/patient-religion',\n    // declare a codeableConcept\n    b.cc(\n      ['1023', 'http://terminology.hl7.org/CodeSystem/v3-ReligiousAffiliation'],\n      { text: 'Muslim' }\n    )\n  );\n\n  return state;\n});\n")),(0,r.yg)("p",null,"Creates a patient with an ",(0,r.yg)("inlineCode",{parentName:"p"},"religious affiliation")," extension:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "resourceType": "Patient",\n  "extension": [\n    {\n      "url": "http://hl7.org/fhir/StructureDefinition/patient-religion",\n      "valueCodeableConcept": {\n        "coding": [\n          {\n            "code": "1023",\n            "system": "http://terminology.hl7.org/CodeSystem/v3-ReligiousAffiliation"\n          }\n        ],\n        "text": "Muslim"\n      }\n    }\n  ]\n}\n')),(0,r.yg)("p",null,"You can call ",(0,r.yg)("inlineCode",{parentName:"p"},"addExtension")," Multiple times for a given resource. It will\nintelligently manage the ",(0,r.yg)("inlineCode",{parentName:"p"},"extension")," array on the target resource for you."),(0,r.yg)("p",null,"In addition, some datatype builders, like, ",(0,r.yg)("inlineCode",{parentName:"p"},"identifier"),", allow extensions to be\npassed as extra arguments. For example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.identifier('12345', {\n  url: 'http://hospital.example.org/fhir/StructureDefinition/identifier-issuingDepartment',\n  value: 'Emergency Department',\n});\n")),(0,r.yg)("p",null,"Produces an identifier like:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "extension": [\n    {\n      "url": "http://hospital.example.org/fhir/StructureDefinition/identifier-issuingDepartment",\n      "valueString": "Emergency Department"\n    }\n  ],\n  "value": "12345"\n}\n')),(0,r.yg)("h3",{id:"system-mappings"},"System Mappings"),(0,r.yg)("p",null,"FHIR builders allow ",(0,r.yg)("inlineCode",{parentName:"p"},"system")," strings in identifiers and codings to be mapped.\nThis allows you to specify short-form system strings, or more easily map\nresources between FHIR systems."),(0,r.yg)("p",null,"This is done using the ",(0,r.yg)("inlineCode",{parentName:"p"},"util.setSystemMap(map)")," function. This takes an object\nwhich maps source strings to destinations. Keys in the object are values you\nwant to use in your job code - the values you pass to the builders. The values\nof the object are the target values - the systems you want to appear in your\ngenerated resources."),(0,r.yg)("p",null,"Set the system map at the top of every step that needs a system map (note that\nmappings are NOT remembered between steps)"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"util.setSystemMap({ icd10: 'http://hl7.org/fhir/sid/icd-10' });\n")),(0,r.yg)("p",null,"Because systems tend to be long strings, it can be convenient to define a\nshort-hand syntax, which simplifies mapping code."),(0,r.yg)("p",null,"For example:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"b.setSystemMap({\n  smartcare: 'http://moh.gov.et/fhir/hiv/identifier/SmartCareID',\n});\n\ncreate(\n  b.patient({\n    identifier: { value: 'xyz', system: 'smartcare' },\n  })\n);\n")),(0,r.yg)("p",null,"This will generate a resource with a full system:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},'{\n  "resourceType": "Patient"\n  "identifier": [\n    {\n      "system": "http://moh.gov.et/fhir/hiv/identifier/SmartCareID",\n      "value": "xyz"\n    }\n  ],\n}\n')),(0,r.yg)("p",null,"You can also use the datatype helpers directly:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"util.setSystemMap({ icd10: 'http://hl7.org/fhir/sid/icd-10' });\n\nfn(state => {\n  const headache = b.coding('G44.1', 'icd10');\n  // ...\n  return state;\n});\n")),(0,r.yg)("p",null,"This is also useful when mapping resources from one FHIR system to another.\nSimply configure a system map and source systems will auto-map to the\ndestinations:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"// map incoming CDR systems to MOH systems\nutil.setSystemMap({\n  'http://cdr.aacahb.gov.et/Encounter':\n    'http://moh.gov.et/fhir/hiv/identifier/encounter',\n});\n\nb.patient({\n  identifier: $.patient.\n});\n")))}g.isMDXComponent=!0},15680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>y});var a=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(t),c=r,y=d["".concat(s,".").concat(c)]||d[c]||g[c]||i;return t?a.createElement(y,o(o({ref:n},u),{},{components:t})):a.createElement(y,o({ref:n},u))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=c;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"}}]);