"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[21300],{19302:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(58168),o=(n(96540),n(15680));const r={title:"Configure Steps"},i=void 0,s={unversionedId:"build/steps/steps",id:"build/steps/steps",title:"Configure Steps",description:"A Step is a specific task or activity in a workflow. Each Step is linked to an",source:"@site/docs/build/steps/steps.md",sourceDirName:"build/steps",slug:"/build/steps/",permalink:"/documentation/build/steps/",draft:!1,editUrl:"https://github.com/openfn/docs/edit/main/docs/build/steps/steps.md",tags:[],version:"current",frontMatter:{title:"Configure Steps"},sidebar:"docs",previous:{title:"Triggers",permalink:"/documentation/build/triggers"},next:{title:"Edit & Test Steps",permalink:"/documentation/build/steps/step-editor"}},p={},l=[{value:"Create or edit a Step",id:"create-or-edit-a-step",level:2},{value:"Configure the Step",id:"configure-the-step",level:2},{value:"1. Name your Step",id:"1-name-your-step",level:2},{value:"2. Choose an Adaptor",id:"2-choose-an-adaptor",level:2},{value:"3.Choose an Adaptor Version",id:"3choose-an-adaptor-version",level:3},{value:"Managing Adaptor Versions",id:"managing-adaptor-versions",level:4},{value:"4. Write a Job for custom business logic or data transformation rules",id:"4-write-a-job-for-custom-business-logic-or-data-transformation-rules",level:3}],d={toc:l},c="wrapper";function u(e){let{components:t,...r}=e;return(0,o.yg)(c,(0,a.A)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"A Step is a specific task or activity in a workflow. Each Step is linked to an\n",(0,o.yg)("a",{parentName:"p",href:"/adaptors/"},"Adaptor")," and contains business logic to perform a specific task or\noperation in that target app. Read on to learn more."),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"In OpenFn V1, there was no concept of ",(0,o.yg)("inlineCode",{parentName:"p"},"Workflow Steps"),"--they were referred to as\n",(0,o.yg)("inlineCode",{parentName:"p"},"Jobs"),'. In V2, we now refer to Jobs as the "job expressions" or "script" that\ndefine the business logic and transformation rules of individual ',(0,o.yg)("inlineCode",{parentName:"p"},"Steps"),".")),(0,o.yg)("h2",{id:"create-or-edit-a-step"},"Create or edit a Step"),(0,o.yg)("p",null,"Via the Workflow Canvas, click the plus ",(0,o.yg)("inlineCode",{parentName:"p"},"+")," icon to create a ",(0,o.yg)("em",{parentName:"p"},"new")," Step, or\nclick on existing Step to view or configure its key components."),(0,o.yg)("h2",{id:"configure-the-step"},"Configure the Step"),(0,o.yg)("p",null,"When configuring a Step, you must understand its basic anatomy."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"Step Anatomy",src:n(17183).A,width:"1516",height:"848"})),(0,o.yg)("p",null,"A Step includes these key components:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"Name")," - A human-readable name describing the Step and its purpose."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"Adaptor")," - The selected ",(0,o.yg)("a",{parentName:"li",href:"/adaptors/"},"Adaptor")," that is used to provide\napp-specific functionality for this Step (e.g., ",(0,o.yg)("inlineCode",{parentName:"li"},"dhis2")," or ",(0,o.yg)("inlineCode",{parentName:"li"},"commcare"),")."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"Adaptor Version")," - The version of the selected Adaptor, which determines\nwhich API endpoints and Adaptor functions are available. See below section to\nlearn more."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"Credentials")," - The Credential used to authorize connections to the target app\nrelated to this Step."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"Job")," - The custom code that defines the business logic and/or sequence of\noperations to be executed in the connected app.")),(0,o.yg)("admonition",{title:"Writing Jobs",type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Writing Jobs to add custom logic for business or data transformation rules\ntypically requires basic knowledge of JavaScript. See the\n",(0,o.yg)("a",{parentName:"p",href:"/documentation/build/workflows"},"Job-writing docs")," for a detailed overview and\nthe ",(0,o.yg)("a",{parentName:"p",href:"/adaptors/library"},"Library Examples")," for sample code.")),(0,o.yg)("h2",{id:"1-name-your-step"},"1. Name your Step"),(0,o.yg)("p",null,"First, give your Step a ",(0,o.yg)("inlineCode",{parentName:"p"},"Name")," that describes its purpose (e.g.,\n",(0,o.yg)("inlineCode",{parentName:"p"},"create patient"),", ",(0,o.yg)("inlineCode",{parentName:"p"},"map form data"),");"),(0,o.yg)("h2",{id:"2-choose-an-adaptor"},"2. Choose an Adaptor"),(0,o.yg)("p",null,"Next, select an ",(0,o.yg)("inlineCode",{parentName:"p"},"Adaptor")," to define which app your Step will connect with."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Each Step can only have 1 Adaptor. If you want to connect with 2 different apps,\nyou should create 2 different Steps.")),(0,o.yg)("p",null,"We've got a whole section on creating new ",(0,o.yg)("a",{parentName:"p",href:"/adaptors"},"Adaptors"),", but the\ncritical thing to be aware of when writing a step is that you've got to choose\nan ",(0,o.yg)("strong",{parentName:"p"},"Adaptor"),", and an ",(0,o.yg)("strong",{parentName:"p"},"Adaptor Version"),"."),(0,o.yg)("p",null,"All of the discussion below of helper functions like ",(0,o.yg)("inlineCode",{parentName:"p"},"create")," or ",(0,o.yg)("inlineCode",{parentName:"p"},"findPatient"),"\nrequires some understanding of adaptors. When you run a step, you're borrowing a\nlayer of functionality that's been built to connect with some specific API, type\nof API, or database."),(0,o.yg)("p",null,"For example, ",(0,o.yg)("inlineCode",{parentName:"p"},"create")," means one thing in the ",(0,o.yg)("inlineCode",{parentName:"p"},"salesforce")," Adaptor and another\nthing entirely in ",(0,o.yg)("inlineCode",{parentName:"p"},"dhis2"),". For this reason, before you can begin writing a step\nyou have to decide which ",(0,o.yg)("a",{parentName:"p",href:"/adaptors/"},"Adaptor")," to work with."),(0,o.yg)("h3",{id:"3choose-an-adaptor-version"},"3.Choose an Adaptor Version"),(0,o.yg)("p",null,"Pick the Adaptor Version you want to use. We recommend selecting the latest\nversion available, unless you want to use an older version that is compatible\nwith an older version of the API you're connecting with. See the\n",(0,o.yg)("a",{parentName:"p",href:"/adaptors"},"Adaptor docs")," for details on each Adaptor."),(0,o.yg)("p",null,'Adaptors change over time. They\'re open source, and we encourage as much\ncontribution as possible\u2014releasing new versions for use on OpenFn.org as soon as\nthey pass our security reviews. New features may be added and bugs may be fixed,\nbut in order to make sure that an existing integration is not broken, we\nrecommend that you select a specific version (rather than using the\n"auto-upgrade" feature) when you choose an adaptor. The highest released version\nis the default choice here.'),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"The ",(0,o.yg)("em",{parentName:"p"},"first 4 lines")," in the log of any run on OpenFn will tell you what adaptor\nyou're running. (As well as the version of worker, engine and NodeJs) This is\nincredibly important, particularly if you're trying to troubleshoot steps in\nvarious environments (like your own shell, app.openfn.org etc.).")),(0,o.yg)("p",null,"Pay careful attention to which ",(0,o.yg)("inlineCode",{parentName:"p"},"version")," you're using to write a step. Consider\nthe following run logs:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"Versions for run f470a3da-8b90-480e-a94f-6dd982c91afe:\n    \u25b8 node.js                     18.19.0\n    \u25b8 worker                      0.5.0\n    \u25b8 engine                      0.2.6\n    \u25b8 @openfn/language-primero    2.9.1\n...more logs here...\n")),(0,o.yg)("h4",{id:"managing-adaptor-versions"},"Managing Adaptor Versions"),(0,o.yg)("p",null,"While it may be beneficial to upgrade as part of your routine maintenance, these\nupgrades should be carefully tested. Most often, customers upgrade to a new\nadaptor version for an existing step when they are making business-drives\nchanges to that step. Some business-driven changes may actually ",(0,o.yg)("em",{parentName:"p"},"require"),"\nupgrading the version in order to use a new feature from the adaptor. Even if\nthose changes don't require and upgrade, if the technical team must spend time\ntesting step-specific changes anyway, it may be an ideal opportunity to test\nalso test an upgrade."),(0,o.yg)("p",null,"Adaptors follow ",(0,o.yg)("a",{parentName:"p",href:"https://semver.org/"},"SEMVER")," so you can be reasonably assured\nthat upgrading from ",(0,o.yg)("inlineCode",{parentName:"p"},"x.1.z")," to ",(0,o.yg)("inlineCode",{parentName:"p"},"x.2.z")," will not lead to existing step code\nfailing, but an upgrade from ",(0,o.yg)("inlineCode",{parentName:"p"},"3.y.z")," to ",(0,o.yg)("inlineCode",{parentName:"p"},"4.y.z")," may\u2014in SEMVER ",(0,o.yg)("em",{parentName:"p"},"major")," upgrades\n(those that change the first number in the ",(0,o.yg)("inlineCode",{parentName:"p"},"x.y.z"),' version number) have\n"breaking" or "non-backwards compatible" changes.'),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"When you configure a Step, you can select a specific ",(0,o.yg)("inlineCode",{parentName:"p"},"Adaptor Version")," to\nversion-lock your Step. Avoid selecting ",(0,o.yg)("inlineCode",{parentName:"p"},"latest")," for Adaptor Version, if you\nwant this and to avoid the risk of accidental upgrades on live Workflows.")),(0,o.yg)("h3",{id:"4-write-a-job-for-custom-business-logic-or-data-transformation-rules"},"4. Write a Job for custom business logic or data transformation rules"),(0,o.yg)("p",null,"Click the code button ",(0,o.yg)("inlineCode",{parentName:"p"},"</>"),' displayed on the configuration panel to write or\nedit a Job expression to define the "rules" or the specific tasks to be\ncompleted by your Step. See the pages on ',(0,o.yg)("a",{parentName:"p",href:"/documentation/build/steps/step-editor"},"the Inspector")," and\n",(0,o.yg)("a",{parentName:"p",href:"/documentation/jobs/job-writing-guide"},"writing Jobs")," to learn more."))}u.isMDXComponent=!0},15680:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>y});var a=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=l(n),g=o,y=c["".concat(p,".").concat(g)]||c[g]||u[g]||r;return n?a.createElement(y,i(i({ref:t},d),{},{components:n})):a.createElement(y,i({ref:t},d))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=g;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[c]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},17183:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/anatomy_of_step-27817f3991261bcb0ea47b0e8388a8c3.png"}}]);