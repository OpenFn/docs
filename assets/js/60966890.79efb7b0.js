"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[30637],{12440:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"packages/formsg-readme","title":"formsg developer readme","description":"Source//github.com/OpenFn/adaptors/tree/main/packages/formsg","source":"@site/adaptors/packages/formsg-readme.md","sourceDirName":"packages","slug":"/packages/formsg-readme","permalink":"/adaptors/packages/formsg-readme","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"formsg developer readme","id":"formsg-readme","keywords":["adaptor","readme","formsg"]},"sidebar":"adaptors","previous":{"title":"Changelog","permalink":"/adaptors/packages/formsg-changelog"},"next":{"title":"Functions","permalink":"/adaptors/packages/gemini-docs"}}');var o=s(74848),r=s(28453);const t={title:"formsg developer readme",id:"formsg-readme",keywords:["adaptor","readme","formsg"]},a="formsg Adaptor developer README.md",d={},c=[{value:"Overview",id:"overview",level:2},{value:"Documentation",id:"documentation",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Decrypt a submission (without signature verification)",id:"decrypt-a-submission-without-signature-verification",level:3},{value:"Decrypt with signature verification",id:"decrypt-with-signature-verification",level:3},{value:"Process webhook (verify and decrypt in one step)",id:"process-webhook-verify-and-decrypt-in-one-step",level:3},{value:"Important Limitations",id:"important-limitations",level:2},{value:"Webhook Signature Verification",id:"webhook-signature-verification",level:3},{value:"Why This Limitation Exists",id:"why-this-limitation-exists",level:3},{value:"Decryption Always Works",id:"decryption-always-works",level:3},{value:"Workarounds for Custom Deployments",id:"workarounds-for-custom-deployments",level:3},{value:"Development",id:"development",level:2},{value:"Testing Locally",id:"testing-locally",level:3},{value:"Resources",id:"resources",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"formsg-adaptor-developer-readmemd",children:"formsg Adaptor developer README.md"})}),"\n",(0,o.jsxs)(n.p,{children:["Source: ",(0,o.jsx)(n.a,{href:"https://github.com/OpenFn/adaptors/tree/main/packages/formsg",children:"https://github.com/OpenFn/adaptors/tree/main/packages/formsg"})]}),"\n",(0,o.jsxs)(n.h1,{id:"language-formsg-",children:["language-formsg ",(0,o.jsx)("img",{src:"./assets/square.png",width:"30",height:"30"})]}),"\n",(0,o.jsxs)(n.p,{children:["An OpenFn ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:"adaptor"})})," for decrypting and verifying FormSG webhook submissions."]}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsxs)(n.p,{children:["This adaptor wraps the ",(0,o.jsx)(n.a,{href:"https://github.com/opengovsg/formsg-javascript-sdk",children:"@opengovsg/formsg-sdk"})," to provide easy decryption and verification of FormSG form submissions in OpenFn workflows."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Key Features:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Decrypt end-to-end encrypted FormSG submissions"}),"\n",(0,o.jsx)(n.li,{children:"Verify webhook signatures (for official FormSG deployments)"}),"\n",(0,o.jsx)(n.li,{children:"Support for multiple FormSG environments (production, staging, development)"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"documentation",children:"Documentation"}),"\n",(0,o.jsxs)(n.p,{children:["View the ",(0,o.jsx)(n.a,{href:"https://docs.openfn.org/adaptors/packages/formsg-docs",children:"docs site"})," for full technical documentation."]}),"\n",(0,o.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["View the ",(0,o.jsx)(n.a,{href:"https://docs.openfn.org/adaptors/packages/formsg-configuration-schema/",children:"configuration-schema"})," for required and optional ",(0,o.jsx)(n.code,{children:"configuration"})," properties."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Sample configuration:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "formSecretKey": "your-form-secret-key-from-formsg",\n  "mode": "development",\n  "webhookEndpoint": "https://your-domain.com/webhook"\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,o.jsx)(n.h3,{id:"decrypt-a-submission-without-signature-verification",children:"Decrypt a submission (without signature verification)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"decryptSubmission(state.data);\n"})}),"\n",(0,o.jsx)(n.h3,{id:"decrypt-with-signature-verification",children:"Decrypt with signature verification"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"decryptSubmission(state.data, {\n  verifySignature: true,\n  signatureHeader: state.headers['x-formsg-signature']\n});\n"})}),"\n",(0,o.jsx)(n.h3,{id:"process-webhook-verify-and-decrypt-in-one-step",children:"Process webhook (verify and decrypt in one step)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"processWebhook(state.data, state.headers['x-formsg-signature']);\n"})}),"\n",(0,o.jsx)(n.h2,{id:"important-limitations",children:"Important Limitations"}),"\n",(0,o.jsx)(n.h3,{id:"webhook-signature-verification",children:"Webhook Signature Verification"}),"\n",(0,o.jsxs)(n.p,{children:["The FormSG SDK uses ",(0,o.jsx)(n.strong,{children:"hardcoded public signing keys"})," for webhook signature verification. This means:"]}),"\n",(0,o.jsxs)(n.p,{children:["\u2705 ",(0,o.jsx)(n.strong,{children:"Signature verification works with:"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Official FormSG production"}),"\n",(0,o.jsx)(n.li,{children:"Official FormSG staging"}),"\n",(0,o.jsxs)(n.li,{children:["FormSG deployed in ",(0,o.jsx)(n.code,{children:"development"})," mode"]}),"\n",(0,o.jsxs)(n.li,{children:["FormSG deployed in ",(0,o.jsx)(n.code,{children:"test"})," mode"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["\u274c ",(0,o.jsx)(n.strong,{children:"Signature verification does NOT work with:"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Custom FormSG deployments using different signing keys"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"why-this-limitation-exists",children:"Why This Limitation Exists"}),"\n",(0,o.jsxs)(n.p,{children:["The signing keys in the SDK (see ",(0,o.jsx)(n.a,{href:"https://github.com/opengovsg/formsg-javascript-sdk/blob/develop/src/resource/signing-keys.ts",children:"signing-keys.ts"}),") are used to verify that webhooks genuinely come from official FormSG servers. Custom deployments use different signing keys that aren't in the SDK."]}),"\n",(0,o.jsx)(n.h3,{id:"decryption-always-works",children:"Decryption Always Works"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Form submission decryption works with ANY FormSG deployment"})," (official or custom), as long as you have the form's secret key. The limitation only applies to webhook signature verification."]}),"\n",(0,o.jsx)(n.h3,{id:"workarounds-for-custom-deployments",children:"Workarounds for Custom Deployments"}),"\n",(0,o.jsx)(n.p,{children:"If you're running a custom FormSG deployment:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Use development/test mode"})," - Deploy your FormSG instance using the public ",(0,o.jsx)(n.code,{children:"development"})," or ",(0,o.jsx)(n.code,{children:"test"})," signing keys from the SDK"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Skip signature verification"})," - Use ",(0,o.jsx)(n.code,{children:"decryptSubmission()"})," without the ",(0,o.jsx)(n.code,{children:"verifySignature"})," option"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Fork the SDK"})," - Modify the SDK to inject your custom public signing key (or contribute back via PR!)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"development",children:"Development"}),"\n",(0,o.jsxs)(n.p,{children:["Clone the ",(0,o.jsx)(n.a,{href:"https://github.com/OpenFn/adaptors",children:"adaptors monorepo"}),'. Follow the "Getting Started" guide inside to get set up.']}),"\n",(0,o.jsxs)(n.p,{children:["Run tests using ",(0,o.jsx)(n.code,{children:"pnpm run test"})," or ",(0,o.jsx)(n.code,{children:"pnpm run test:watch"})]}),"\n",(0,o.jsxs)(n.p,{children:["Build the project using ",(0,o.jsx)(n.code,{children:"pnpm build"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To build ",(0,o.jsx)(n.em,{children:"only"})," the docs run ",(0,o.jsx)(n.code,{children:"pnpm build docs"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"testing-locally",children:"Testing Locally"}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.code,{children:"LOCAL_TEST.md"})," for instructions on testing this adaptor locally with the OpenFn CLI."]}),"\n",(0,o.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/opengovsg/formsg-javascript-sdk",children:"FormSG JavaScript SDK"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://form.gov.sg",children:"FormSG Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://international.open.gov.sg/self-hosting/formsg",children:"FormSG Self-hosting Documentation"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://docs.openfn.org",children:"OpenFn Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(96540);const o={},r=i.createContext(o);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);