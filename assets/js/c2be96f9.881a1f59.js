"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[68749],{28453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>a});var s=o(96540);const t={},r=s.createContext(t);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:n},e.children)}},78496:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"moodle","title":"Moodle","description":"Overview","source":"@site/adaptors/moodle.md","sourceDirName":".","slug":"/moodle","permalink":"/adaptors/moodle","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Moodle"},"sidebar":"adaptors","previous":{"title":"README.md","permalink":"/adaptors/packages/mongodb-readme"},"next":{"title":"Functions","permalink":"/adaptors/packages/mpesa-docs"}}');var t=o(74848),r=o(28453);const l={title:"Moodle"},a=void 0,i={},d=[{value:"Overview",id:"overview",level:2},{value:"Integration Use Cases",id:"integration-use-cases",level:3},{value:"Learn More",id:"learn-more",level:3},{value:"Integration Options",id:"integration-options",level:2},{value:"More on the Moodle API",id:"more-on-the-moodle-api",level:3},{value:"Connect with OpenFn",id:"connect-with-openfn",level:2},{value:"Implementation Examples",id:"implementation-examples",level:2}];function c(e){const n={a:"a",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://moodle.org/",children:"Moodle"})," is a free and open-source online learning\nmanagement system."]}),"\n",(0,t.jsx)(n.h3,{id:"integration-use-cases",children:"Integration Use Cases"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"As a teacher on Moodle, I want to send profile, enrollment, and grade updates\nto CommCare so I can continue supporting students offline."}),"\n",(0,t.jsx)(n.li,{children:"As a teacher on Moodle, I want to automatically send student engagement data\nto CommCare so I can integrate SMS notifications to increase student\nparticipation."}),"\n",(0,t.jsx)(n.li,{children:"As a student on Moodle, I want to access my course data and grades even when\nnot connected to the internet."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"learn-more",children:"Learn More"}),"\n",(0,t.jsx)(n.p,{children:"Helpful links..."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Moodle Docs \u2013 ",(0,t.jsx)(n.a,{href:"https://docs.moodle.org/310/en/Main_page",children:"https://docs.moodle.org/310/en/Main_page"})]}),"\n",(0,t.jsxs)(n.li,{children:["Moodle API Docs - ",(0,t.jsx)(n.a,{href:"https://moodle.org/plugins/webservice_restful",children:"https://moodle.org/plugins/webservice_restful"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"integration-options",children:"Integration Options"}),"\n",(0,t.jsxs)(n.p,{children:["Data integration via the Moodle web API:\n",(0,t.jsx)(n.a,{href:"https://moodle.org/plugins/webservice_restful",children:"https://moodle.org/plugins/webservice_restful"})]}),"\n",(0,t.jsxs)(n.p,{children:["Data forwarding using a Webhook: ",(0,t.jsx)(n.a,{href:"https://moodle.org/plugins/local_webhooks",children:"https://moodle.org/plugins/local_webhooks"})]}),"\n",(0,t.jsx)(n.h3,{id:"more-on-the-moodle-api",children:"More on the Moodle API"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Sample HTTP requests"})}),"\n",(0,t.jsxs)(n.p,{children:["Authentication:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"GET mymoodlesite.com/login/token.php?service=moodle_mobile_app &username=USERNAME&password=PASSWORD"})]}),"\n",(0,t.jsxs)(n.p,{children:["Retrieve course information for all courses:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"GET /cv_dgdp/webservice/rest/server.php?wstoken=TOKEN&wsfunction= core_course_get_courses&moodlewsrestformat=json HTTP/1.1"})]}),"\n",(0,t.jsxs)(n.p,{children:["Retrieve enrolled users in a specific course:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"GET /cv_dgdp/webservice/rest/server.php?wstoken=TOKEN&wsfunction= core_enrol_get_enrolled_users&courseid=225&moodlewsrestformat=json HTTP/1.1"})]}),"\n",(0,t.jsxs)(n.p,{children:["Retrieve all final grades for one student:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"GET /cv_dgdp/webservice/rest/server.php?wstoken=TOKEN&wsfunction= gradereport_user_get_grade_items&userid=46580&courseid=225&moodlewsrestformat=json HTTP/1.1"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Integration tips"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["The endpoint ",(0,t.jsx)(n.code,{children:"get_enrolled_users"})," does not return all user profile details.\nWe have had to access ",(0,t.jsx)(n.code,{children:"core_user_get_users_by_field"})," and filter by one\nspecific user to retrieve profile information such as phone number and\naddress."]}),"\n",(0,t.jsx)(n.li,{children:"Googling the endpoint you're using goes a long way!"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"connect-with-openfn",children:"Connect with OpenFn"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"https://github.com/OpenFn/language-http#language-http-",children:(0,t.jsx)(n.code,{children:"language-http"})}),"\ncan be used to make HTTP requests to the Moodle API."]}),"\n",(0,t.jsx)(n.h2,{id:"implementation-examples",children:"Implementation Examples"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Moodle -> CommCare Integration:"})}),"\n",(0,t.jsxs)(n.p,{children:["In a project implementation for creating an education app (based on CommCare),\nwe extract data from a Moodle learning management system daily, and then upload\nMoodle student ",(0,t.jsx)(n.code,{children:"user"})," data as ",(0,t.jsx)(n.code,{children:"case"})," records in Commcare."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Example User Story: As a coach using CommCare, when a student's profile and\ngrades are updated in Moodle, I would like to automatically see that data\nreflected in my mobile app so that I can follow-up with the relevant support to\nensure they perform well."})}),"\n",(0,t.jsxs)(n.p,{children:["Example job to get enrolled users via the Moodle API endpoint (aka\n",(0,t.jsx)(n.code,{children:"web service function"}),"): ",(0,t.jsx)(n.code,{children:"core_enrol_get_enrolled_users"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"fn(state => {\n  const { loginUrl, username, password, host } = state.configuration;\n  return get(\n    `${loginUrl}&username=${username}&password=${password}`,\n    {},\n    state => {\n      const { token } = state.data;\n      const courseIds = [224, 225];\n      const enrolledUsers = [];\n      return each(\n        courseIds,\n        fn(state => {\n          let courseid = state.data;\n          return get(\n            `${host}`,\n            {\n              query: {\n                wstoken: token,\n                wsfunction: 'core_enrol_get_enrolled_users',\n                courseid,\n                moodlewsrestformat: 'json',\n              },\n              headers: { 'content-type': 'application/json' },\n            },\n            state => {\n              console.log(\n                `Getting users enrolled in the course with ${courseid}...`\n              );\n              enrolledUsers.push(state.data);\n              return { ...state, enrolledUsers };\n            }\n          )(state);\n        })\n      )(state);\n    }\n  )(state);\n});\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);