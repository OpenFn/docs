"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[2782],{28453:(e,r,a)=>{a.d(r,{R:()=>i,x:()=>o});var _=a(96540);const s={},n=_.createContext(s);function i(e){const r=_.useContext(n);return _.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),_.createElement(n.Provider,{value:r},e.children)}},60589:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>_,toc:()=>t});const _=JSON.parse('{"id":"library/jobs/auto/Upsert-Aggregate-Service-Referrals-2021-04-30","title":"Upsert Aggregate Service Referrals","description":"This job was provided by an OpenFn.org user via the job library API.","source":"@site/adaptors/library/jobs/auto/Upsert-Aggregate-Service-Referrals-2021-04-30.md","sourceDirName":"library/jobs/auto","slug":"/library/jobs/auto/Upsert-Aggregate-Service-Referrals-2021-04-30","permalink":"/adaptors/library/jobs/auto/Upsert-Aggregate-Service-Referrals-2021-04-30","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Upsert Aggregate Service Referrals","sidebar_label":"Upsert Aggregate Service Referrals","id":"Upsert-Aggregate-Service-Referrals-2021-04-30","keywords":["library","job","expression","salesforce","dataValue","field","fields","relationship","upsert"]},"sidebar":"adaptors","previous":{"title":"Upsert ART Adherence Self-Reporting Tool","permalink":"/adaptors/library/jobs/auto/Upsert-ART-Adherence-Self-Reporting-Tool-2021-04-30"},"next":{"title":"Risk and Vulnerability Assessment","permalink":"/adaptors/library/jobs/auto/Risk-and-Vulnerability-Assessment-2021-05-27"}}');var s=a(74848),n=a(28453);const i={title:"Upsert Aggregate Service Referrals",sidebar_label:"Upsert Aggregate Service Referrals",id:"Upsert-Aggregate-Service-Referrals-2021-04-30",keywords:["library","job","expression","salesforce","dataValue","field","fields","relationship","upsert"]},o=void 0,l={},t=[{value:"Metadata",id:"metadata",level:2},{value:"Key Functions",id:"key-functions",level:2},{value:"Expression",id:"expression",level:2}];function f(e){const r={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("em",{children:"This job was provided by an OpenFn.org user via the job library API."}),"\n",(0,s.jsx)(r.h2,{id:"metadata",children:"Metadata"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Name: Upsert Aggregate Service Referrals"}),"\n",(0,s.jsxs)(r.li,{children:["Adaptor: ",(0,s.jsx)(r.a,{href:"https://www.github.com/openfn/language-salesforce",children:(0,s.jsx)(r.code,{children:"@openfn/language-salesforce"})})]}),"\n",(0,s.jsxs)(r.li,{children:["Adaptor Version: ",(0,s.jsx)(r.a,{href:"https://www.github.com/openfn/language-salesforce/releases/tag/v2.7.4",children:(0,s.jsx)(r.code,{children:"v2.7.4"})})]}),"\n",(0,s.jsx)(r.li,{children:"Created about 4 years ago"}),"\n",(0,s.jsx)(r.li,{children:"Updated 4 months ago"}),"\n",(0,s.jsxs)(r.li,{children:["Score: ",(0,s.jsx)("b",{children:"0"})," (an ",(0,s.jsx)(r.a,{href:"/adaptors/library/#library-scores",children:"indicator"})," of how useful this job may be)"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"key-functions",children:"Key Functions"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"dataValue"}),", ",(0,s.jsx)(r.code,{children:"field"}),", ",(0,s.jsx)(r.code,{children:"fields"}),", ",(0,s.jsx)(r.code,{children:"relationship"}),", ",(0,s.jsx)(r.code,{children:"upsert"})]}),"\n",(0,s.jsx)(r.h2,{id:"expression",children:"Expression"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",children:"// Push to production\nupsert(\n  'GRS_Referral_Agg__c',\n  'CommCare_Ext_ID__c',\n  fields(\n    relationship(\n      'SiteName__r',\n      'CommCare_Ext_ID__c',\n      dataValue('form.general_referral_information.event_information.site')\n    ),\n    field('CommCare_Ext_ID__c', dataValue('form.general_referral_information.event_information.site')),\n    //TO DO\n    //field('Business_Unit__c', dataValue('form.general_referral_information.event_information.business_unit')),\n    field('Business_Unit__c', state => {\n      const bu = dataValue('form.general_referral_information.event_information.business_unit')(state); \n      return bu==='65680f0c4c144b03ad0f86bdc46c1ebc' ? 'GRS Zambia' : \n      bu==='04d98397e28046118fade28ced6b65cb' ? 'GRS Zimbabwe' : \n      bu==='ed125ab19ec34aacab79585e59eb76f4' ? 'GRS Partnerships': undefined ; \n    }),\n    relationship(\n        //Attendance looks up to Event via the intervention_name\n        'Events__r',\n        'CommCare_Ext_ID__c',\n        dataValue('form.general_referral_information.event_information.event_name')\n      ),\n    field('Type_of_Referral__c', dataValue('form.general_referral_information.type_of_referral')),\n    field(\n      'Enter_Partner_s_Name__c',\n      dataValue('form.general_referral_information.partner_or_organization_referred_to')\n    ),\n    field('Males_Referred_HIV_Testing__c', dataValue('form.hivsti_services.males_referred_for_hiv_testing')),\n    field('Males_referred_for_STI_Screening__c', dataValue('form.hivsti_services.males_referred_for_sti_screening')),\n    field('Males_Referred_for_PEP__c', dataValue('form.hivsti_services.males_referred_for_pep')),\n    field('Males_Referred_for_PrEP__c', dataValue('form.hivsti_services.males_referred_for_prep')),\n    field('Males_Referred_for_VMMC__c', dataValue('form.hivsti_services.males_referred_for_vmmc')),\n    field('Females_Referred_for_HIV_Testing__c', dataValue('form.hivsti_services.females_referred_for_hiv_testing')),\n    field(\n      'Females_Referred_for_STI_Screening__c',\n      dataValue('form.hivsti_services.females_referred_for_sti_screening')\n    ),\n    field('Date_Referred__c', dataValue('form.general_referral_information.date_referred')),\n    field('Females_Referred_for_PEP__c', dataValue('form.hivsti_services.females_referred_for_pep')),\n    field('Females_Referred_for_PrEP__c', dataValue('form.hivsti_services.females_referred_for_prep')),\n    field('Males_Referred_for_ART__c', dataValue('form.art_services.males_referred_for_art')),\n    field('Males_Referred_for_SKILLZ_Club__c', dataValue('form.art_services.males_referred_for_skillz__club')),\n    field('Females_Referred_for_ART__c', dataValue('form.art_services.females_referred_for_art')),\n    field('Females_Referred_SKILLZ_Club__c', dataValue('form.art_services.females_referred_for_skillz__club')),\n    field('Females_Referred_for_PMTCT__c', dataValue('form.art_services.females_referred_for_pmtct')),\n    \n    field(\n      'Males_Referred_for_Psycho_Social_Support__c',\n      dataValue('form.psycho_-_social_services.males_referred_for_psycho-social_support')\n    ),\n    field(\n      'Females_Referred_Psycho_Social_Support__c',\n      dataValue('form.psycho_-_social_services.females_referred_for_psycho-social_support')\n    ),\n    field('Males_Referred_for_TB_Screening__c', dataValue('form.tb_services.males_referred_for_tb_screening')),\n    field('Females_Referred_for_TB_Screening__c', dataValue('form.tb_services.females_referred_for_rb_screening')),\n    field(\n      'Number_of_Male_Condoms_distributed__c',\n      dataValue('form.condom_distributions.number_of_male_condoms_distributed')\n    ),\n    field('Number_of_Male_Condoms_Accessed__c', dataValue('form.condom_distributions.number_of_male_condoms_accessed')),\n    field(\n      'Number_of_Female_Condoms_distributed__c',\n      dataValue('form.condom_distributions.number_of_female_condoms_distributed')\n    ),\n    field(\n      'Number_of_Female_Condoms_Accessedx__c',\n      dataValue('form.condom_distributions.number_of_female_condoms_accessed')\n    ),\n    field(\n      'Females_Referred_for_Family_Planning__c',\n      dataValue('form.other_srhr_services.females_referred_for_family_planning')\n    ),\n    field(\n      'Females_Referred_for_Cervical_Cancer__c',\n      dataValue('form.other_srhr_services.females_referred_for_cervical_cancer')\n    ),\n    field('Females_Referred_for_Antenatal__c', dataValue('form.other_srhr_services.females_referred_for_antenatal')),\n    field(\n      'Males_Referred_for_Malaria_Testing__c',\n      dataValue('form.other_referral_services.males_referred_for_malaria_testing')\n    ),\n    field('Males_Referred_for_GBV__c', dataValue('form.other_referral_services.males_referred_for_gbv')),\n    field(\n      'Females_Referred_for_Malaria_Testing__c',\n      dataValue('form.other_referral_services.females_referred_for_malaria_testing')\n    ),\n    field('Females_Referred_for_GBV__c', dataValue('form.other_referral_services.females_referred_for_gbv')),\n    field(\n      'Females_Referred_for_HPV_Vaccine__c',\n      dataValue('form.other_referral_services.females_referred_for_hpv_vaccine')\n    )\n  )\n);\n"})})]})}function d(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(f,{...e})}):f(e)}}}]);