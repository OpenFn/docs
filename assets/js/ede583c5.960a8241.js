"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[63817],{11341:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/webhook_trigger-b8ab066bd761552d7d734a3179b81832.png"},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(96540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},52358:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"build/triggers","title":"Triggers","description":"Triggers allow you to start the execution of Workflows automatically. They come","source":"@site/docs/build/triggers.md","sourceDirName":"build","slug":"/build/triggers","permalink":"/documentation/build/triggers","draft":false,"unlisted":false,"editUrl":"https://github.com/openfn/docs/edit/main/docs/build/triggers.md","tags":[],"version":"current","frontMatter":{"title":"Triggers"},"sidebar":"docs","previous":{"title":"Workflows","permalink":"/documentation/build/workflows"},"next":{"title":"Configure Steps","permalink":"/documentation/build/steps/"}}');var s=t(74848),i=t(28453);const o={title:"Triggers"},a=void 0,l={},c=[{value:"Webhook Event Triggers",id:"webhook-event-triggers",level:2},{value:"Cron Triggers (formerly timers)",id:"cron-triggers-formerly-timers",level:2},{value:"Managing the size of <code>state</code> for Cron Workflows",id:"managing-the-size-of-state-for-cron-workflows",level:3},{value:"A quick fix for final state bloat",id:"a-quick-fix-for-final-state-bloat",level:3},{value:"Kafka Triggers (beta) \ud83d\udea7",id:"kafka-triggers-beta-",level:2},{value:"Configuring a Kafka trigger for your workflow",id:"configuring-a-kafka-trigger-for-your-workflow",level:3},{value:"Known &quot;sharp edges&quot; on the Kafka trigger feature",id:"known-sharp-edges-on-the-kafka-trigger-feature",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Triggers allow you to start the execution of Workflows automatically. They come\nin three types: Cron triggers, Webhook Event, and Kafka triggers."}),"\n",(0,s.jsx)(n.h2,{id:"webhook-event-triggers",children:"Webhook Event Triggers"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Webhook Event Triggers"})," listen for inbound HTTP requests (messages from other\nsystems), and enable real-time, event-based automation."]}),"\n",(0,s.jsx)(n.p,{children:'These triggers are fired by "pushing" data to OpenFn (i.e., by sending an HTTP\n\u201cPOST\u201d request to your trigger\u2019s designated URL).'}),"\n",(0,s.jsx)(n.p,{children:"The triggering HTTP request might be sent via a webhook in an external app,\nanother OpenFn workflow, or manually (i.e., via cURL request)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Webhook Trigger",src:t(11341).A+"",width:"512",height:"706"})}),"\n",(0,s.jsxs)(n.p,{children:["To learn about how to add an additional layer of security to your Webhook\nTrigger by adding authentication, head over to our\n",(0,s.jsx)(n.a,{href:"/documentation/webhook-security",children:"Webhook Security"})," page."]}),"\n",(0,s.jsxs)(n.p,{children:["Learn how a workflow's initial ",(0,s.jsx)(n.code,{children:"state"})," gets built from a webhook trigger\n",(0,s.jsx)(n.a,{href:"../jobs/state#webhook-triggered-runs",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"cron-triggers-formerly-timers",children:"Cron Triggers (formerly timers)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cron Triggers"})," run Workflows based on a cron schedule, and are good for\nrepetitive tasks that are time-based (e.g., every day at 8am, sync financial\ndata)."]}),"\n",(0,s.jsx)(n.p,{children:"These Triggers enable users to \u201cpull\u201d data from connected systems. You can pick\na standard schedule (e.g., every day, or every month), or define a custom\nschedule using cron expressions."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Cron Trigger",src:t(90982).A+"",width:"492",height:"710"})}),"\n",(0,s.jsx)(n.admonition,{title:"Help with cron expressions",type:"tip",children:(0,s.jsxs)(n.p,{children:["The best way to learn about ",(0,s.jsx)(n.code,{children:"cron"}),", if you're not already familiar, is through\nthe OpenFn interface or\n",(0,s.jsx)("a",{href:"https://crontab.guru",target:"_blank",children:"crontab.guru"}),"."]})}),"\n",(0,s.jsx)(n.p,{children:"Cron Triggers enable Workflows to be run as frequently as once every minute, or\nas infrequently as you desire and can be scheduled on very specific dates or\ntimes."}),"\n",(0,s.jsxs)(n.p,{children:["Learn how a workflow's initial ",(0,s.jsx)(n.code,{children:"state"})," gets built from a cron trigger\n",(0,s.jsx)(n.a,{href:"/documentation/jobs/state#cron-triggered-runs",children:"here"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["You can use a Cursor to help build input state when the workflow is triggered:\nsee the ",(0,s.jsx)(n.a,{href:"/documentation/jobs/job-writing-guide#using-cursors",children:"Job Writing Guide"}),"\nfor more details."]}),"\n",(0,s.jsxs)(n.p,{children:["Each time a timed job succeeds, its ",(0,s.jsx)(n.code,{children:"final_state"})," will be saved and used as the\ninput state for its next run."]}),"\n",(0,s.jsxs)(n.h3,{id:"managing-the-size-of-state-for-cron-workflows",children:["Managing the size of ",(0,s.jsx)(n.code,{children:"state"})," for Cron Workflows"]}),"\n",(0,s.jsxs)(n.p,{children:["Since state is passed between each run of a cron Workflow, if your Workflow Step\nadds something new to state each time it runs, it may quickly become too large\nto be practically handled. Imagine if a server response were adding, via\n",(0,s.jsx)(n.code,{children:"array.push(...)"}),", to ",(0,s.jsx)(n.code,{children:"state.references"})," each time the job ran. OpenFn supports\nup to 50,000 bytes (via Erlang's ",(0,s.jsx)(n.code,{children:"byte_size"}),"), though most ",(0,s.jsx)(n.code,{children:"final_state"})," byte\nsizes are between 100 and 1000."]}),"\n",(0,s.jsxs)(n.p,{children:["If the size of your ",(0,s.jsx)(n.code,{children:"final_state"})," exceeds 10,000 bytes, OpenFn will send project\ncollaborators a warning email. If it exceeds 50,000 bytes, your run will still\nsucceed but its ",(0,s.jsx)(n.code,{children:"final_state"})," will not be saved and the next time that job runs\nit will inherit the previous, un-updated final state. (I.e., the last state that\nwas < 50,000 bytes.)"]}),"\n",(0,s.jsx)(n.h3,{id:"a-quick-fix-for-final-state-bloat",children:"A quick fix for final state bloat"}),"\n",(0,s.jsxs)(n.p,{children:["Most often, final ",(0,s.jsx)(n.code,{children:"state"})," bloat is due to improper handling of\n",(0,s.jsx)(n.code,{children:"state.references"})," or ",(0,s.jsx)(n.code,{children:"state.data"}),". This can be fixed by cleaning up your final\n",(0,s.jsx)(n.code,{children:"state"})," by adding and customizing the following lines ",(0,s.jsx)(n.em,{children:"either"})," to the callback\nof your language-package's operation (if it allows for one) or by appending a\n",(0,s.jsx)(n.code,{children:"fn(...)"})," operation after your final operation."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"fn(state => {\n  state.custom = somethingIntentional;\n  state.data = {};\n  state.references = [];\n  return state;\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"kafka-triggers-beta-",children:"Kafka Triggers (beta) \ud83d\udea7"}),"\n",(0,s.jsxs)(n.p,{children:["The Kafka trigger allows OpenFn users to build Workflows triggered by messages\npublished by a Kafka cluster. The triggers make use of Kafka consumer groups\nthat are set up on-demand to receive messages from a defined cluster then\nconverts them to ",(0,s.jsx)(n.code,{children:"Input"})," dataclips that are used to initialize a Work Order."]}),"\n",(0,s.jsx)(n.admonition,{title:"For self-hosted OpenFn deployments",type:"info",children:(0,s.jsxs)(n.p,{children:["Instance administrators have to enable Kafka for their instance by setting\n",(0,s.jsx)(n.code,{children:"KAFKA_TRIGGERS_ENABLED=yes"})," in the environment variable."]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Configuring Kafka Trigger",src:t(98383).A+"",width:"2424",height:"1630"})}),"\n",(0,s.jsx)(n.admonition,{title:"What is Kafka?",type:"info",children:(0,s.jsxs)(n.p,{children:["Apache Kafka\xae is an event streaming platform designed to handle high volumes of\ndata. Check out\n",(0,s.jsx)(n.a,{href:"https://kafka.apache.org/documentation/#gettingStarted",children:"Kafka Docs"})," to learn\nmore."]})}),"\n",(0,s.jsx)(n.h3,{id:"configuring-a-kafka-trigger-for-your-workflow",children:"Configuring a Kafka trigger for your workflow"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a new Workflow or open an existing Workflow in your Project"}),"\n",(0,s.jsxs)(n.li,{children:["Click on the workflow's Trigger and change the trigger type to\n",(0,s.jsx)(n.code,{children:"Kafka Consumer"})," in the ",(0,s.jsx)(n.code,{children:"Trigger type"})," dropdown."]}),"\n",(0,s.jsx)(n.li,{children:"Fill out the required connection details:"}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hosts"}),": Provide the URL of the host(s) your trigger should listen to for\nmessages."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Topics"}),": Enter the topics your Kafka consumers should subscribe to. You\nneed at least one topic for a successful connection."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SSL"}),": Some Kafka clusters require SSL connection. If you are connecting to\nan environment that requires SSL connection, select ",(0,s.jsx)(n.code,{children:"Enable SSL"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SSL Authentication"}),": Select the type of Authentication required for the\nKafka cluster."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Initial offset policy"}),": The intial offset dictates where the consumer\nstarts reading messages from a topic when it subscribes for the first time.\nThere are three possible options: ",(0,s.jsx)(n.code,{children:"earliest"})," messages available, ",(0,s.jsx)(n.code,{children:"latest"}),"\nmessages available, or messages with a specific ",(0,s.jsx)(n.code,{children:"timestamp"})," (e.g.,\n",(0,s.jsx)(n.code,{children:"1721889238000"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Connect timeout"}),": The connect timeout specified in seconds (e.g., ",(0,s.jsx)(n.code,{children:"30"}),")\nrepresents how long the consumer should wait before timing out when attempting\nto connect with a Kafka cluster."]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["If you have not finished designing your Workflow or you're not ready to start\nreceiving messages from the Kafka cluster, please check the box to ",(0,s.jsx)(n.strong,{children:"disable\nthe trigger"})," until you're ready for message ingestion to begin."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Disable the trigger during workflow design",type:"warning",children:(0,s.jsxs)(n.p,{children:["Once the required connection information is provided via the modal, the trigger\nwill ",(0,s.jsx)(n.em,{children:"immediately"})," start attempting to connect to the Kafka cluster. We advise\nthat the trigger is disabled until your workflow is ready to receive data from\nthe cluster for processing. ",(0,s.jsxs)(n.strong,{children:["To stop the trigger from receiving and processing\nmessages, check the ",(0,s.jsx)(n.code,{children:"Disable this trigger"})," checkbox at the bottom of the trigger\nconfiguration modal."]})]})}),"\n",(0,s.jsxs)(n.p,{children:["Learn how the initial ",(0,s.jsx)(n.code,{children:"state"})," (and ",(0,s.jsx)(n.code,{children:"Input"}),") for Kafka-triggered Workflows gets\nbuilt ",(0,s.jsx)(n.a,{href:"../jobs/state#kafka-triggered-runs",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"known-sharp-edges-on-the-kafka-trigger-feature",children:'Known "sharp edges" on the Kafka trigger feature'}),"\n",(0,s.jsxs)(n.p,{children:["We'll monitor bug/exception reports, perform user interviews and collect feature\nrequests during the beta to determine which of these rough-edges are worth\nironing out, and how to do so assuming that the community wants to support Kafka\ntriggers going forward. Please don't hesitate to reach out on\n",(0,s.jsx)(n.a,{href:"https://community.openfn.org",children:"community.openfn.org"})," to make your voice heard!"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Performance settings are out of the ",(0,s.jsx)(n.em,{children:"end-user's"})," control and can only be set\nat instance-level. As there is quite a close relationship between cluster and\nconsumer settings, this may prove to be an obstacle as users will not be able\nto tune their consumers to align with their individual clusters in large\nmulti-tenant deployments."]}),"\n",(0,s.jsx)(n.li,{children:"If a run could not be turned into a Workflow (due to persistence errors or\nhitting the hard limit), these will not be visible to the end-user and may be\nlost forever (i.e. the cluster thinks Lightning has them but it doesn't and\nthey eventually rotate off the cluster)"}),"\n",(0,s.jsx)(n.li,{children:"Errors are written to the log and to Sentry; nothing is visible to the\nend-user."}),"\n",(0,s.jsx)(n.li,{children:"Reprocessing dropped messages isn't practical if you are not writing failed\nmessages to some sort of persistent file storage."}),"\n",(0,s.jsx)(n.li,{children:"If a consumer group is disconnected from a cluster long enough for the\ncluster to forget the last message, we may not be able to prevent duplicates\nmaking it through (as a result of instance-wide de-duplication settings)."}),"\n",(0,s.jsxs)(n.li,{children:["We cannot provide concurrency ",(0,s.jsx)(n.em,{children:"and"})," honour message sequence that is based on\nthe Kafka message key mechanism. If a user wants to guarantee the Kafka\nmessage sequence, they must enable 1-at-a-time processing on OpenFn by\nturning their workflow concurrency down to 1."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},90982:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/cron_trigger-65e425bf9442fa127c2c3d117810e3c7.png"},98383:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/configuring-kafka-cb7e22422de261c0b3df8fa42bfd0bf6.png"}}]);