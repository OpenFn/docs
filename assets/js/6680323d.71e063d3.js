"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[93133],{28453:(e,s,r)=>{r.d(s,{R:()=>c,x:()=>i});var n=r(96540);const t={},d=n.createContext(t);function c(e){const s=n.useContext(d);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(d.Provider,{value:s},e.children)}},59217:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"packages/surveycto-docs","title":"surveycto@2.2.7","description":"cursor(value, options)","source":"@site/adaptors/packages/surveycto-docs.md","sourceDirName":"packages","slug":"/packages/surveycto-docs","permalink":"/adaptors/packages/surveycto-docs","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"surveycto@2.2.7","id":"surveycto-docs","keywords":["adaptor","surveycto","cursor","fetchSubmissions","request"]},"sidebar":"adaptors","previous":{"title":"Overview","permalink":"/adaptors/surveycto"},"next":{"title":"Configuration","permalink":"/adaptors/packages/surveycto-configuration-schema"}}');var t=r(74848),d=r(28453);const c={title:"surveycto@2.2.7",id:"surveycto-docs",keywords:["adaptor","surveycto","cursor","fetchSubmissions","request"]},i=void 0,o={},l=[{value:"Functions",id:"functions",level:2},{value:"cursor",id:"cursor",level:3},{value:"fetchSubmissions",id:"fetchsubmissions",level:3},{value:"request",id:"request",level:3},{value:"Interfaces",id:"interfaces",level:2},{value:"FetchSubmissionOptions",id:"fetchsubmissionoptions",level:3},{value:"RequestOptions",id:"requestoptions",level:3}];function a(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"#cursor",children:"cursor(value, options)"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"#fetchsubmissions",children:"fetchSubmissions(formId, options, callback)"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"#request",children:"request(path, params, callback)"})})]}),"\n",(0,t.jsx)(s.p,{children:"This adaptor exports the following from common:"}),"\n",(0,t.jsxs)("dl",{children:[(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#alterstate",children:"alterState()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#chunk",children:"chunk()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#datapath",children:"dataPath()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#datavalue",children:"dataValue()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#datefns",children:"dateFns"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#field",children:"field()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#fields",children:"fields()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#fn",children:"fn()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#fnif",children:"fnIf()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#lastreferencevalue",children:"lastReferenceValue()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#merge",children:"merge()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#parsecsv",children:"parseCsv()"})}),(0,t.jsx)("dt",{children:(0,t.jsx)("a",{href:"/adaptors/packages/common-docs#sourcevalue",children:"sourceValue()"})})]}),"\n",(0,t.jsx)(s.h2,{id:"functions",children:"Functions"}),"\n",(0,t.jsx)(s.h3,{id:"cursor",children:"cursor"}),"\n",(0,t.jsx)("p",{children:(0,t.jsx)("code",{children:"cursor(value, options) \u21d2 Operation"})}),"\n",(0,t.jsxs)(s.p,{children:["Sets ",(0,t.jsx)(s.code,{children:"state.cursor"})," to a SurveyCTO timestamp string (",(0,t.jsx)(s.code,{children:"MMM dd, yyy h:mm:ss a"}),").\nThis supports natural language dates like ",(0,t.jsx)(s.code,{children:"now"}),", ",(0,t.jsx)(s.code,{children:"today"}),", ",(0,t.jsx)(s.code,{children:"yesterday"}),", ",(0,t.jsx)(s.code,{children:"n hours ago"}),", ",(0,t.jsx)(s.code,{children:"n days ago"}),", and ",(0,t.jsx)(s.code,{children:"start"}),",\nwhich will be converted into timestamp strings.\nSee the usage guide at ",(0,t.jsx)(s.a,{href:"https://docs.openfn.org/documentation/jobs/job-writing-guide#using-cursors",children:"https://docs.openfn.org/documentation/jobs/job-writing-guide#using-cursors"})]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Param"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"value"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"any"})}),(0,t.jsx)(s.td,{children:"the cursor value. Usually an ISO date, natural language date, or page number"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"options"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"object"})}),(0,t.jsx)(s.td,{children:"options to control the cursor."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"options.key"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{children:"set the cursor key. Will persist through the whole run."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"options.defaultValue"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"any"})}),(0,t.jsx)(s.td,{children:"the value to use if value is falsy"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"options.format"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"function"})}),(0,t.jsx)(s.td,{children:"custom formatter for the final cursor value"})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"})," Use a cursor from state if present, or else use the default value"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"cursor('today')\nfetchSubmissions('test', { date: $.cursor });\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"fetchsubmissions",children:"fetchSubmissions"}),"\n",(0,t.jsx)("p",{children:(0,t.jsx)("code",{children:"fetchSubmissions(formId, options, callback) \u21d2 Operation"})}),"\n",(0,t.jsx)(s.p,{children:"Fetch form submissions."}),"\n",(0,t.jsxs)(s.p,{children:["If a date filter is provided, it will be  converted internally to the surveyCTO ",(0,t.jsx)(s.code,{children:"MMM dd, yyy h:mm:ss"})," format (in UTC time)."]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Param"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"formId"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{children:"Form id"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"options"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.a,{href:"#fetchsubmissionoptions",children:(0,t.jsx)("code",{children:"FetchSubmissionOptions"})})}),(0,t.jsx)(s.td,{children:"Form submission date, format, status parameters"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"callback"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"function"})}),(0,t.jsx)(s.td,{children:"(Optional) Callback function"})]})]})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"})," Fetch all form submissions"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"fetchSubmissions('test');\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"}),"  With SurveyCTO date format (UTC)"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"fetchSubmissions('test', { date: 'Apr 18, 2024 6:26:21 AM' });\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"})," Using a rolling cursor"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"cursor((state) => state.cursor, { defaultValue: 'today' });\nfetchSubmissions('test', { date: (state) => state.cursor, format: 'csv' });\ncursor('now');\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"}),"  Formatting the results to CSV String"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"fetchSubmissions('test', { format: 'csv' });\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"}),"  With reviewStatus filter"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"fetchSubmissions('test', { status: 'approved|rejected' });\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Example:"}),"  With a callback function"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"fetchSubmissions(\n  'test',\n  {\n    date: 'Apr 18, 2024 6:26:21 AM',\n  },\n  state => {\n    console.log('Hello from the callback!');\n    return state;\n  }\n);\n"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"request",children:"request"}),"\n",(0,t.jsx)("p",{children:(0,t.jsx)("code",{children:"request(path, params, callback) \u21d2 Operation"})}),"\n",(0,t.jsx)(s.p,{children:"Make a request in SurveyCTO API"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Param"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"path"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{children:"Path to resource"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"params"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.a,{href:"#requestoptions",children:(0,t.jsx)("code",{children:"RequestOptions"})})}),(0,t.jsx)(s.td,{children:"Query, body and method parameters"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"callback"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"function"})}),(0,t.jsx)(s.td,{children:"(Optional) Callback function"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Example"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'request("/anEndpoint", {\n  method: "POST",\n  query: { foo: "bar", a: 1 },\n});\n'})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"interfaces",children:"Interfaces"}),"\n",(0,t.jsx)(s.h3,{id:"fetchsubmissionoptions",children:"FetchSubmissionOptions"}),"\n",(0,t.jsxs)(s.p,{children:["Options provided to ",(0,t.jsx)(s.code,{children:"fetchSubmissions()"})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Properties"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[date]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"0"})}),(0,t.jsx)(s.td,{children:"Fetch only submissions from this timestamp. Acccepts SuvreyCTO date strings, unix and epoch timestamps, and ISO dates. By default, all submissions will be retrieved."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[format]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:'"json"'})}),(0,t.jsxs)(s.td,{children:["Format the submission data type as  ",(0,t.jsx)(s.code,{children:"csv"})," or ",(0,t.jsx)(s.code,{children:"json"}),"."]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[status]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{}),(0,t.jsxs)(s.td,{children:["Review status. Can be either, ",(0,t.jsx)(s.code,{children:"approved"}),", ",(0,t.jsx)(s.code,{children:"rejected"}),", ",(0,t.jsx)(s.code,{children:"pending"})," or combine eg `approved"]})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"requestoptions",children:"RequestOptions"}),"\n",(0,t.jsx)(s.p,{children:"Options provided to request()"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Properties"})}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Name"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Default"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[headers]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"object"})}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{children:"An object of headers parameters."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[body]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"object"})}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{children:"Body data to append to the request."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[query]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"object"})}),(0,t.jsx)(s.td,{}),(0,t.jsx)(s.td,{children:"An object of query parameters to be encoded into the URL."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"[method]"}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:"string"})}),(0,t.jsx)(s.td,{children:(0,t.jsx)("code",{children:'"GET"'})}),(0,t.jsx)(s.td,{children:"The HTTP method to use."})]})]})]}),"\n",(0,t.jsx)(s.hr,{})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);