"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[66351],{6483:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=t(58168),r=(t(96540),t(15680));const o={title:"OpenMRS Adaptor"},i=void 0,s={unversionedId:"openmrs",id:"openmrs",title:"OpenMRS Adaptor",description:"About OpenMRS",source:"@site/adaptors/openmrs.md",sourceDirName:".",slug:"/openmrs",permalink:"/adaptors/openmrs",draft:!1,tags:[],version:"current",frontMatter:{title:"OpenMRS Adaptor"},sidebar:"adaptors",previous:{title:"openlmis developer readme",permalink:"/adaptors/packages/openlmis-readme"},next:{title:"openmrs@5.0.2",permalink:"/adaptors/packages/openmrs-docs"}},p={},l=[{value:"About OpenMRS",id:"about-openmrs",level:2},{value:"Integration Options",id:"integration-options",level:2},{value:"Authentication",id:"authentication",level:2},{value:"API Basics",id:"api-basics",level:2},{value:"REST API Operations",id:"rest-api-operations",level:3},{value:"HTTP Utility Functions",id:"http-utility-functions",level:2},{value:"FHIR Helpers",id:"fhir-helpers",level:2},{value:"Helpful Links",id:"helpful-links",level:3},{value:"Implementation Examples",id:"implementation-examples",level:3}],u={toc:l},c="wrapper";function g(e){let{components:n,...t}=e;return(0,r.yg)(c,(0,a.A)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h2",{id:"about-openmrs"},"About OpenMRS"),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://openmrs.org/"},"OpenMRS (Open Medical Record System)")," is an open-source\nplatform designed to manage electronic medical records (EMRs) in low-resource\nenvironments. It provides a framework that allows developers to extend its core\nfunctionality through custom modules and APIs."),(0,r.yg)("h2",{id:"integration-options"},"Integration Options"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"1. Rest API:")," OpenMRS offers a REST API that enables external applications to\ninteract with its database and perform bulk operations. This option is ideal for\napplications requiring scheduled or bulk synchronization with OpenMRS. Refer to\nthe OpenMRS REST API ",(0,r.yg)("a",{parentName:"p",href:"https://wiki.openmrs.org/"},"documentation")," for detailed\nguidelines on endpoints and payload formats."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"2. Webhook:")," OpenMRS does not natively support webhooks as a standard\nfeature. However, the platform is highly extensible and allows for customization\nthrough its module system. More details can be found on the OpenMRS\n",(0,r.yg)("a",{parentName:"p",href:"https://wiki.openmrs.org/"},"documentation page\u200b"),"."),(0,r.yg)("h2",{id:"authentication"},"Authentication"),(0,r.yg)("p",null,"When integrating with OpenMRS via OpenFn, ",(0,r.yg)("strong",{parentName:"p"},"Basic Authentication")," is supported."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"instanceUrl"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"username")," an ",(0,r.yg)("inlineCode",{parentName:"p"},"password")," properties are all required to\naccess your OpenMRS instance."),(0,r.yg)("p",null,"See ",(0,r.yg)("a",{parentName:"p",href:"documentation/manage-projects/manage-credentials"},"Managing Credentials")," to\nconfigure a credential in OpenFn."),(0,r.yg)("p",null,"If working locally or if using a Raw JSON credential type, then your\nconfiguration will look something like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'{\n  "instanceUrl": "http://openmrs.com/instance/url",\n  "password":"test",\n  "username":"test"\n}\n')),(0,r.yg)("p",null,"See this adaptor's\n",(0,r.yg)("a",{parentName:"p",href:"/adaptors/packages/openmrs-configuration-schema"},"Configuration docs")," for more\ndetails."),(0,r.yg)("h2",{id:"api-basics"},"API Basics"),(0,r.yg)("p",null,"There are three ways you can use the OpenMRS API, all available interchangeable\nin the same step in a workflow."),(0,r.yg)("p",null,'Like other adaptors, the FHIR adaptor "returns" output by writing to\n',(0,r.yg)("inlineCode",{parentName:"p"},"state.data"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"get('patient/71075074-f02e-4270-89a3-f2dcda436f70');\nfn(state => {\n  console.log(state.data); // the downloaded patient is available here\n  return state;\n});\n")),(0,r.yg)("h3",{id:"rest-api-operations"},"REST API Operations"),(0,r.yg)("p",null,"The main namespace contains high-level helper functions, which are designed as\nthe primary interface. These are designed to handle the most common use cases,\nlike downloading OpenMRS resources. They will configure default values and\nhandle some complications for you, like authorization and pagination."),(0,r.yg)("p",null,"All requests generated by these operations are made against your instance URL\nplus ",(0,r.yg)("inlineCode",{parentName:"p"},"ws/rest/v1"),"."),(0,r.yg)("p",null,"For a list of valid resource types, see the\n",(0,r.yg)("a",{parentName:"p",href:"https://rest.openmrs.org/#openmrs-rest-api"},"OpenMRS REST API Docs"),". These docs\nare a useful resource when using OpenMRS, as different resources have different\nusage rules."),(0,r.yg)("p",null,"For example, to download all concepts:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"get('concept');\n// calls <instanceUrl>/ws/rest/v1/concept\n")),(0,r.yg)("p",null,"Each resource in OpenMRS defines a number of query parameters. These can be\npassed as an options object as the second argument. For example, to set the\n",(0,r.yg)("a",{parentName:"p",href:"https://rest.openmrs.org/#list-all-concepts"},(0,r.yg)("inlineCode",{parentName:"a"},"source")," parameter")," on the concept\nresource:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"get('concept', { source: 'SNOWMED' });\n// calls <instanceUrl>/ws/rest/v1/concept?source=SNOWMED\n")),(0,r.yg)("p",null,"Most options are appended to the request URL as query parameters, so you can\npass whatever parameters OpenMRS requires."),(0,r.yg)("p",null,"The adaptor will download resources over multiple pages. Each individual request\nto OpenMRS will be logged, for debugging and optimization."),(0,r.yg)("p",null,"Note that by default, the function imposes a download limit of 10,000 records.\nYou can force all data to be downloaded by passing ",(0,r.yg)("inlineCode",{parentName:"p"},"max: Infinity"),", like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"get('concept', { max: Infinity });\n")),(0,r.yg)("p",null,"When paging, the adaptor will make multiple requests. By default each request\nwill download a page of data according to the instance's configuration. To force\na larger page size (and reduce the number of requests, pass ",(0,r.yg)("inlineCode",{parentName:"p"},"pageSize"),")"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"get('concept', { pageSize: 1000 });\n")),(0,r.yg)("p",null,"To disable pagination and force a single request, set ",(0,r.yg)("inlineCode",{parentName:"p"},"limit"),"."),(0,r.yg)("p",null,"You can page from a specific position by passing ",(0,r.yg)("inlineCode",{parentName:"p"},"startIndex"),". This works with\npagination and with ",(0,r.yg)("inlineCode",{parentName:"p"},"limit"),"."),(0,r.yg)("h2",{id:"http-utility-functions"},"HTTP Utility Functions"),(0,r.yg)("p",null,"The REST API operations are be opinionated, and in some cases can make too many\nassumptions about what you want to do."),(0,r.yg)("p",null,"The operations in the ",(0,r.yg)("inlineCode",{parentName:"p"},"http")," namespace are simpler, lower-level helpers and work\nmore like curl or postman. They'll do exactly what you ask for them. They'll\nhandle authorization for you but won't paginate or prepend anything to the\nrequested path."),(0,r.yg)("p",null,"To request a single page of concepts, you can do:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"http.get('ws/rest/v1/concept');\n")),(0,r.yg)("p",null,"You can pass a query via the options object:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"http.get('ws/rest/v1/concept', {\n  query: {\n    limit: 1000,\n    source: 'SNOWMED',\n  },\n});\n")),(0,r.yg)("p",null,"Using the http helpers, pagination must be implemented manually."),(0,r.yg)("p",null,"The HTTP helpers write to things to your state object:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"state.data")," is the response body returned by OpenMRS"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"state.response")," is the rest of the HTTP response (excluding the body),\nincluding ",(0,r.yg)("inlineCode",{parentName:"li"},"statusCode"),", ",(0,r.yg)("inlineCode",{parentName:"li"},"statusMessage")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"headers"),".")),(0,r.yg)("h2",{id:"fhir-helpers"},"FHIR Helpers"),(0,r.yg)("p",null,"The OpenMRS adaptor also provides a\n",(0,r.yg)("a",{parentName:"p",href:"https://docs.openfn.org/adaptors/packages/openmrs-docs#fhir"},"FHIR helper API"),",\nwhich allows you to make requests against FHIR endpoints and download FHIR data."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-js"},"fhir.get('Encounter', {\n  count: 100,\n  lastUpdated: 'ge2024-01-01T00:00:00Z',\n});\n")),(0,r.yg)("h3",{id:"helpful-links"},"Helpful Links"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("a",{parentName:"li",href:"https://openmrs.atlassian.net/wiki/spaces/docs/pages/25476048/Developer+Guide"},"OpenMRS Developer Guide")),(0,r.yg)("li",{parentName:"ol"},"Community Forums: ",(0,r.yg)("a",{parentName:"li",href:"https://talk.openmrs.org/"},"OpenMRS Talk"))),(0,r.yg)("h3",{id:"implementation-examples"},"Implementation Examples"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"OpenFn Prototype for M\xe9decins Sans Fronti\xe8res (MSF) LIME Project - OpenMRS ->\nDHIS2 sync:\n",(0,r.yg)("a",{parentName:"li",href:"https://github.com/OpenFn/openfn-lime"},"https://github.com/OpenFn/openfn-lime"))))}g.isMDXComponent=!0},15680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>m});var a=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),l=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=l(e.components);return a.createElement(p.Provider,{value:n},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=l(t),d=r,m=c["".concat(p,".").concat(d)]||c[d]||g[d]||o;return t?a.createElement(m,i(i({ref:n},u),{},{components:t})):a.createElement(m,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var p in n)hasOwnProperty.call(n,p)&&(s[p]=n[p]);s.originalType=e,s[c]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);