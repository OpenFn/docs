"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[52074],{27085:(a,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"library/jobs/auto/async-findValue","title":"Using findValue with an array of data","description":"\ud83d\udcdc This job is an official example from OpenFn.","source":"@site/adaptors/library/jobs/auto/async-findValue.md","sourceDirName":"library/jobs/auto","slug":"/library/jobs/auto/async-findValue","permalink":"/adaptors/library/jobs/auto/async-findValue","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Using findValue with an array of data","sidebar_label":"\ud83d\udcdc Using findValue with an array of data","id":"async-findValue","keywords":["library","job","expression","postgresql","findValue","upsertMany","async","await"]},"sidebar":"adaptors","previous":{"title":"Configuration","permalink":"/adaptors/packages/postgresql-configuration-schema"},"next":{"title":"1. Get data from SLUHIS","permalink":"/adaptors/library/jobs/auto/1-Get-data-from-SLUHIS-2023-03-08"}}');var t=n(74848),r=n(28453);const i={title:"Using findValue with an array of data",sidebar_label:"\ud83d\udcdc Using findValue with an array of data",id:"async-findValue",keywords:["library","job","expression","postgresql","findValue","upsertMany","async","await"]},o=void 0,d={},l=[{value:"Metadata",id:"metadata",level:2},{value:"Key Functions",id:"key-functions",level:2},{value:"Expression",id:"expression",level:2}];function c(a){const e={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...a.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.p,{children:["\ud83d\udcdc ",(0,t.jsx)("em",{children:"This job is an official example from OpenFn."})]}),"\n",(0,t.jsx)(e.h2,{id:"metadata",children:"Metadata"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Name: Using findValue with an array of data"}),"\n",(0,t.jsxs)(e.li,{children:["Adaptor: ",(0,t.jsx)(e.a,{href:"https://www.github.com/openfn/language-postgresql",children:(0,t.jsx)(e.code,{children:"@openfn/language-postgresql"})})]}),"\n",(0,t.jsxs)(e.li,{children:["Adaptor Version: ",(0,t.jsx)(e.a,{href:"https://www.github.com/openfn/language-postgresql",children:(0,t.jsx)(e.code,{children:"latest"})})]}),"\n",(0,t.jsx)(e.li,{children:"Created date unknown"}),"\n",(0,t.jsx)(e.li,{children:"Updated date unknown"}),"\n",(0,t.jsxs)(e.li,{children:["Score: ",(0,t.jsx)("b",{children:"100"})," (an ",(0,t.jsx)(e.a,{href:"/adaptors/library/#library-scores",children:"indicator"})," of how useful this job may be)"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"key-functions",children:"Key Functions"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"findValue"}),", ",(0,t.jsx)(e.code,{children:"upsertMany"}),", ",(0,t.jsx)(e.code,{children:"async"}),", ",(0,t.jsx)(e.code,{children:"await"})]}),"\n",(0,t.jsx)(e.h2,{id:"expression",children:"Expression"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'fn(async state => {\n  const dataArray =\n    state.data.body.st_grass_repeat ||\n    state.data.body["plot_forest_area/st_grass_repeat"] ||\n    [];\n  const dataGrass = [];\n  const path = state.data.body.st_grass_repeat\n    ? "st_grass_repeat"\n    : "plot_forest_area/st_grass_repeat";\n\n  for (let data of uniqueGrass) {\n    dataGrass.push({\n      WCSPROGRAMS_TaxaID: await findValue({\n        uuid: "WCSPROGRAMS_TaxaID",\n        relation: "WCSPROGRAMS_Taxa",\n        where: {\n          ScientificName: `%${state.handleValue(\n            data["st_grass_repeat/grass_species"]\n          )}%`,\n        },\n        operator: { ScientificName: "like" },\n      })(state),\n      UnknownSpeciesImage: data[`${path}/noknown`],\n      GrassPercent: data[`${path}/grass_perc`],\n      GrassHeight: data[`${path}/grass_height`],\n      AnswerId: state.data.body._id,\n    });\n  }\n  \n  return upsertMany(\n    "WCSPROGRAMS_VegetationGrass",\n    "WCSPROGRAMS_VegetationGrassCode",\n    () => dataGrass\n  )(state);\n});\n\n'})})]})}function u(a={}){const{wrapper:e}={...(0,r.R)(),...a.components};return e?(0,t.jsx)(e,{...a,children:(0,t.jsx)(c,{...a})}):c(a)}},28453:(a,e,n)=>{n.d(e,{R:()=>i,x:()=>o});var s=n(96540);const t={},r=s.createContext(t);function i(a){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof a?a(e):{...e,...a}}),[e,a])}function o(a){let e;return e=a.disableParentContext?"function"==typeof a.components?a.components(t):a.components||t:i(a.components),s.createElement(r.Provider,{value:e},a.children)}}}]);