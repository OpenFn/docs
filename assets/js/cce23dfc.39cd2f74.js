"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[62224],{1018:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"tutorials/kobo-to-dhis2","title":"Kobo to DHIS2 Reporting Workflow","description":"In this tutorial, we are going to walk through how to create a simple OpenFn","source":"@site/docs/tutorials/kobo-to-dhis2.md","sourceDirName":"tutorials","slug":"/kobo-to-dhis2","permalink":"/documentation/kobo-to-dhis2","draft":false,"unlisted":false,"editUrl":"https://github.com/openfn/docs/edit/main/docs/tutorials/kobo-to-dhis2.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Kobo to DHIS2","title":"Kobo to DHIS2 Reporting Workflow","slug":"/kobo-to-dhis2"},"sidebar":"docs","previous":{"title":"HTTP to GoogleSheets","permalink":"/documentation/tutorials/http-to-googlesheets"},"next":{"title":"CommCare to PostgreSQL","permalink":"/documentation/tutorials/commcare-to-db"}}');var i=n(74848),s=n(28453);const r={sidebar_label:"Kobo to DHIS2",title:"Kobo to DHIS2 Reporting Workflow",slug:"/kobo-to-dhis2"},d="Create a Workflow automating reporting between KoboToolbox & DHIS2",l={},a=[{value:"Video Walkthrough",id:"video-walkthrough",level:3},{value:"Workflow Overview:",id:"workflow-overview",level:3},{value:"Prerequisites:",id:"prerequisites",level:3},{value:"Step 1: Get Kobo Form Submission",id:"step-1-get-kobo-form-submission",level:3},{value:"Explanation:",id:"explanation",level:4},{value:"Testing:",id:"testing",level:4},{value:"Step 2: Count OPV Dose Given",id:"step-2-count-opv-dose-given",level:3},{value:"Explanation:",id:"explanation-1",level:4},{value:"Testing:",id:"testing-1",level:4},{value:"Step 3: Map and Load to DHIS2",id:"step-3-map-and-load-to-dhis2",level:3},{value:"Explanation:",id:"explanation-2",level:4},{value:"Testing",id:"testing-2",level:4},{value:"Conclusion",id:"conclusion",level:3}];function c(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.header,{children:(0,i.jsx)(o.h1,{id:"create-a-workflow-automating-reporting-between-kobotoolbox--dhis2",children:"Create a Workflow automating reporting between KoboToolbox & DHIS2"})}),"\n",(0,i.jsxs)(o.p,{children:["In this tutorial, we are going to walk through how to create a simple OpenFn\nWorkflow that automates reporting from\n",(0,i.jsx)(o.a,{href:"https://www.kobotoolbox.org/",children:"KoboToolbox"})," (a mobile data collection app) and\n",(0,i.jsx)(o.a,{href:"https://dhis2.org",children:"DHIS2"})," (a health information system commonly used for\naggregate reporting on key indicators) using the the ",(0,i.jsx)(o.code,{children:"kobotoolbox"})," and ",(0,i.jsx)(o.code,{children:"dhis2"}),"\n",(0,i.jsx)(o.a,{href:"/adaptors",children:"Adaptors"}),"."]}),"\n",(0,i.jsx)(o.h3,{id:"video-walkthrough",children:"Video Walkthrough"}),"\n",(0,i.jsx)(o.admonition,{title:"Introduction to Workflows and History tutorial",type:"tip",children:(0,i.jsxs)(o.p,{children:["Watch this\n",(0,i.jsx)(o.a,{href:"https://youtu.be/hae8eM0iYnM?si=LGbv1TK0W9L9y12u",children:"Introduction to Workflows and History tutorial"}),"\nto guide you through this Workflow configuration."]})}),"\n",(0,i.jsx)(o.h3,{id:"workflow-overview",children:"Workflow Overview:"}),"\n",(0,i.jsx)(o.p,{children:"This OpenFn Workflow will have 3 Steps:"}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsx)(o.li,{children:"Fetch form submissions from Kobotoolbox"}),"\n",(0,i.jsxs)(o.li,{children:["Count the number of ",(0,i.jsx)(o.code,{children:"OPV0_dose_given"})," values recorded across submissions to\nreturn an aggregate count of how many beneficiaries have received the OPV0\nimmunication"]}),"\n",(0,i.jsx)(o.li,{children:"Import the aggregate results to DHIS2 to report on the # of doses recorded\nthat week"}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"prerequisites",children:"Prerequisites:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"You have an OpenFn Project"}),"\n",(0,i.jsx)(o.li,{children:"You have a KoboToolbox account and form to sync (see below for demo\ncredentials to use)"}),"\n",(0,i.jsx)(o.li,{children:'Login info for a DHIS2 instance (see below for login info for the "play" DHIS2\ninstance)'}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"step-1-get-kobo-form-submission",children:"Step 1: Get Kobo Form Submission"}),"\n",(0,i.jsx)(o.p,{children:"Create a the first step in Workflow convas."}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Name: ",(0,i.jsx)(o.code,{children:"Get Kobo Form Submission"})]}),"\n",(0,i.jsxs)(o.li,{children:["Adaptor: ",(0,i.jsx)(o.code,{children:"kobotoolbox"})]}),"\n",(0,i.jsxs)(o.li,{children:["Version: ",(0,i.jsx)(o.code,{children:"latest"})]}),"\n",(0,i.jsx)(o.li,{children:"Credential: see belo"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"This step uses the kobotoolbox adaptor and we will use the following credential\nconfiguration"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-json",children:'{\n  "baseURL": "https://kf.kobotoolbox.org",\n  "username": "openfn_demo",\n  "password": "openfn_demo",\n  "apiVersion": "v2"\n}\n'})}),"\n",(0,i.jsxs)(o.p,{children:["In this Step we want to be fetch form submissions from this demo form with the\nid ",(0,i.jsx)(o.code,{children:"aBpweTNdaGJQFb5EBBwUeo"}),". To do so, open the\n",(0,i.jsx)(o.a,{href:"/documentation/build/steps/step-editor",children:"Inspector Editor"})," and add the following Job\ncode:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-javascript",children:"// Step 1: Fetch Form Submissions from Kobotoolbox\ngetSubmissions({ formId: 'aBpweTNdaGJQFb5EBBwUeo' });\n"})}),"\n",(0,i.jsx)(o.p,{children:"::: tip Need help writing job code?"}),"\n",(0,i.jsxs)(o.p,{children:["Check out the docs on the ",(0,i.jsx)(o.a,{href:"/adaptors/kobotoolbox",children:'"kobotoolbox" Adaptor'}),",\n",(0,i.jsx)(o.a,{href:"/documentation/build/steps/",children:"configuring Steps"}),", and\n",(0,i.jsx)(o.a,{href:"/documentation/jobs/job-writing-guide",children:"job-writing"}),"."]}),"\n",(0,i.jsx)(o.p,{children:":::"}),"\n",(0,i.jsx)(o.h4,{id:"explanation",children:"Explanation:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"getSubmissions"}),": Fetches form submissions."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:'{ formId: "aBpweTNdaGJQFb5EBBwUeo" }'}),": Specify the form ID to retrieve\nsubmissions."]}),"\n"]}),"\n",(0,i.jsx)(o.h4,{id:"testing",children:"Testing:"}),"\n",(0,i.jsxs)(o.p,{children:["Create an empty input ",(0,i.jsx)(o.code,{children:"{}"})," then click ",(0,i.jsx)(o.code,{children:"Create New Work Order"})," button to run the\nworkflow. ",(0,i.jsx)(o.a,{href:"/documentation/build/workflows",children:"See docs"})," for more on running Workflows\nmanually."]}),"\n",(0,i.jsxs)(o.p,{children:["The expected ",(0,i.jsx)(o.code,{children:" output"})," should contain 17 records in ",(0,i.jsx)(o.code,{children:"state.data.results"})]}),"\n",(0,i.jsx)(o.h3,{id:"step-2-count-opv-dose-given",children:"Step 2: Count OPV Dose Given"}),"\n",(0,i.jsxs)(o.p,{children:["Create a second Step after ",(0,i.jsx)(o.code,{children:"Get Kobo Form Submission"})," as follows:"]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Name: ",(0,i.jsx)(o.code,{children:"Count OPV Dose Given"})]}),"\n",(0,i.jsxs)(o.li,{children:["Adaptor: ",(0,i.jsx)(o.code,{children:"common"})," (used whenever we want to add custom JavaScript functions)"]}),"\n",(0,i.jsxs)(o.li,{children:["Version: ",(0,i.jsx)(o.code,{children:"latest"})]}),"\n",(0,i.jsx)(o.li,{children:"Credential: none needd"}),"\n"]}),"\n",(0,i.jsxs)(o.p,{children:["In this step we are going to count all records with ",(0,i.jsx)(o.code,{children:'"OPV0_dose_given": "yes"'}),".\nTo add this logic, open the ",(0,i.jsx)(o.a,{href:"/documentation/build/steps/step-editor",children:"Inspector"})," and add\nthe following JOb code in the Editor:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-javascript",children:"// Filter and Count OPV Dose Given\nfn(state => {\n  const opvDosesGivenCount = state.data.results.filter(\n    r => r['OPV0_dose_given'] === 'yes'\n  ).length;\n\n  return { ...state, opvDosesGivenCount };\n});\n"})}),"\n",(0,i.jsx)(o.admonition,{title:"Need help writing job code? Or modifying this logic?",type:"tip",children:(0,i.jsxs)(o.p,{children:["Check out the docs on the ",(0,i.jsx)(o.a,{href:"/adaptors/packages/common-docs",children:'"common" Adaptor'}),",\n",(0,i.jsx)(o.a,{href:"/documentation/build/steps/",children:"configuring Steps"}),", and\n",(0,i.jsx)(o.a,{href:"/documentation/jobs/job-writing-guide",children:"job-writing"}),"."]})}),"\n",(0,i.jsx)(o.h4,{id:"explanation-1",children:"Explanation:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"fn"}),": A function in OpenFn for more flexible job writing. It gives you the\nability to do something to the state and return transformed data to state;"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"opvDosesGivenCount"}),": Counts the occurrences of 'yes' in the ",(0,i.jsx)(o.code,{children:"OPV0_dose_given"}),"\nfield."]}),"\n"]}),"\n",(0,i.jsx)(o.h4,{id:"testing-1",children:"Testing:"}),"\n",(0,i.jsxs)(o.p,{children:["Select the first step ",(0,i.jsx)(o.code,{children:"Get Kobo Form Submission"})," and ",(0,i.jsx)(o.code,{children:"Create New Work Order"}),"\nwith an empty input (",(0,i.jsx)(o.a,{href:"/documentation/build/workflows",children:"see Workflow docs"})," if you need help\nwith running and testing steps). Both steps should be executed successfully and\nyou should see in the final state ",(0,i.jsx)(o.code,{children:"opvDosesGivenCount: 3"})," added."]}),"\n",(0,i.jsx)(o.h3,{id:"step-3-map-and-load-to-dhis2",children:"Step 3: Map and Load to DHIS2"}),"\n",(0,i.jsxs)(o.p,{children:["Create a third Step after ",(0,i.jsx)(o.code,{children:"Count OPV Dose Given"})," as follows:"]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Name: ",(0,i.jsx)(o.code,{children:"Map and Load to DHIS2"})]}),"\n",(0,i.jsxs)(o.li,{children:["Adaptor: ",(0,i.jsx)(o.code,{children:"dhis2"})]}),"\n",(0,i.jsxs)(o.li,{children:["Version: ",(0,i.jsx)(o.code,{children:"v4.0.3"})]}),"\n",(0,i.jsxs)(o.li,{children:["Credential: new ",(0,i.jsx)(o.code,{children:"dhis2"})," credential with the following credential configuration"]}),"\n"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-json",children:'{\n  "hostUrl": "https://play.dhis2.org/dev",\n  "username": "admin",\n  "password": "district"\n}\n'})}),"\n",(0,i.jsxs)(o.p,{children:["In this Step, we want to add logic to import ",(0,i.jsx)(o.code,{children:"dataValues"}),' to DHIS2 to "report"\non the aggregated OPV0 immunization does count calculated in Step 2.']}),"\n",(0,i.jsxs)(o.p,{children:["To do so, open the ",(0,i.jsx)(o.a,{href:"/documentation/build/steps/step-editor",children:"Inspector"}),", add the following\nJob code in the Editor:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-javascript",children:"// Import to DHIS2\ncreate('dataValueSets', state => ({\n  dataSet: 'BfMAe6Itzgt', // Child Health\n  period: '202402', // Feb 2024\n  orgUnit: 'DiszpKrYNg8', // Ngelehun CHC\n  dataValues: [\n    {\n      categoryOptionCombo: 'Prlt0C1RF0s', //Fixed <1yr\n      dataElement: 'x3Do5e7g4Qo', // OPV0 doses given\n      value: state.opvDosesGivenCount, //# of OPV0 doses given\n    },\n  ],\n}));\n"})}),"\n",(0,i.jsx)(o.admonition,{title:"Need help writing job code? Or modifying this logic?",type:"tip",children:(0,i.jsxs)(o.p,{children:["Check out the docs on the ",(0,i.jsx)(o.a,{href:"/adaptors/dhis2",children:'"dhis2" Adaptor'}),",\n",(0,i.jsx)(o.a,{href:"/documentation/build/steps/",children:"configuring Steps"}),", and\n",(0,i.jsx)(o.a,{href:"/documentation/jobs/job-writing-guide",children:"job-writing"}),"."]})}),"\n",(0,i.jsx)(o.h4,{id:"explanation-2",children:"Explanation:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"create('dataValueSets', {...})"}),": This OpenFn function is used to create a new\ndatavalueset in DHIS2."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"dataSet"}),", ",(0,i.jsx)(o.code,{children:"completeDate"}),", ",(0,i.jsx)(o.code,{children:"period"}),", ",(0,i.jsx)(o.code,{children:"orgUnit"}),": Details of the datavalueset."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"dataValues"}),": An array containing data elements and their corresponding\nvalues."]}),"\n"]}),"\n",(0,i.jsx)(o.h4,{id:"testing-2",children:"Testing"}),"\n",(0,i.jsxs)(o.p,{children:["Save your changes then navigate to the first step(Get Kobo Form Submission) and\ncreate an empty input ",(0,i.jsx)(o.code,{children:"{}"})," then click ",(0,i.jsx)(o.code,{children:"Create New Work Order"})," button to run the\nworkflow. All steps should be executed successful and you should see the\n",(0,i.jsx)(o.code,{children:"OPV0 doses given"})," updated in DHIS2. See ",(0,i.jsx)(o.a,{href:"/documentation/build/workflows",children:"Workflow docs"}),"\nif you need help running or testing Workflows."]}),"\n",(0,i.jsx)(o.h3,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsxs)(o.p,{children:["Congratulations! You've successfully created an OpenFn workflow to automate the\nprocess of fetching form submissions from Kobotoolbox, calculated the aggregated\ncount of OPV doses given to beneficiaries, and reporting this count as\n",(0,i.jsx)(o.code,{children:"dataValues"})," to DHIS2."]}),"\n",(0,i.jsx)(o.admonition,{title:"Are you blocked? Have questions?",type:"tip",children:(0,i.jsxs)(o.p,{children:["Watch this\n",(0,i.jsx)(o.a,{href:"https://youtu.be/hae8eM0iYnM?si=LGbv1TK0W9L9y12u",children:"Introduction to Workflows and History tutorial"}),"\nor post your questions on the ",(0,i.jsx)(o.a,{href:"https://community.openfn.org",children:"Community"})," to get\nhelp!"]})})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>r,x:()=>d});var t=n(96540);const i={},s=t.createContext(i);function r(e){const o=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:o},e.children)}}}]);