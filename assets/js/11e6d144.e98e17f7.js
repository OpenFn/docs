"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[20341],{28453:(e,r,t)=>{t.d(r,{R:()=>_,x:()=>i});var a=t(96540);const n={},s=a.createContext(n);function _(e){const r=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:_(e.components),a.createElement(s.Provider,{value:r},e.children)}},41269:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>_,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"library/jobs/auto/Upsert-Service-Referral-2021-04-30","title":"Upsert Service Referral","description":"This job was provided by an OpenFn.org user via the job library API.","source":"@site/adaptors/library/jobs/auto/Upsert-Service-Referral-2021-04-30.md","sourceDirName":"library/jobs/auto","slug":"/library/jobs/auto/Upsert-Service-Referral-2021-04-30","permalink":"/adaptors/library/jobs/auto/Upsert-Service-Referral-2021-04-30","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Upsert Service Referral","sidebar_label":"Upsert Service Referral","id":"Upsert-Service-Referral-2021-04-30","keywords":["library","job","expression","salesforce","alterState","dataValue","field","fields","relationship","upsert"]},"sidebar":"adaptors","previous":{"title":"Upsert Service Referral 2","permalink":"/adaptors/library/jobs/auto/Upsert-Service-Referral-2-2021-06-14"},"next":{"title":"Upsert Risk and Vulnerability Assessment - Service Referral","permalink":"/adaptors/library/jobs/auto/Upsert-Risk-and-Vulnerability-Assessment-Service-Referral-2021-05-25"}}');var n=t(74848),s=t(28453);const _={title:"Upsert Service Referral",sidebar_label:"Upsert Service Referral",id:"Upsert-Service-Referral-2021-04-30",keywords:["library","job","expression","salesforce","alterState","dataValue","field","fields","relationship","upsert"]},i=void 0,c={},l=[{value:"Metadata",id:"metadata",level:2},{value:"Key Functions",id:"key-functions",level:2},{value:"Expression",id:"expression",level:2}];function o(e){const r={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("em",{children:"This job was provided by an OpenFn.org user via the job library API."}),"\n",(0,n.jsx)(r.h2,{id:"metadata",children:"Metadata"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"Name: Upsert Service Referral"}),"\n",(0,n.jsxs)(r.li,{children:["Adaptor: ",(0,n.jsx)(r.a,{href:"https://www.github.com/openfn/language-salesforce",children:(0,n.jsx)(r.code,{children:"@openfn/language-salesforce"})})]}),"\n",(0,n.jsxs)(r.li,{children:["Adaptor Version: ",(0,n.jsx)(r.a,{href:"https://www.github.com/openfn/language-salesforce/releases/tag/v2.7.4",children:(0,n.jsx)(r.code,{children:"v2.7.4"})})]}),"\n",(0,n.jsx)(r.li,{children:"Created about 4 years ago"}),"\n",(0,n.jsx)(r.li,{children:"Updated 5 months ago"}),"\n",(0,n.jsxs)(r.li,{children:["Score: ",(0,n.jsx)("b",{children:"0"})," (an ",(0,n.jsx)(r.a,{href:"/adaptors/library/#library-scores",children:"indicator"})," of how useful this job may be)"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"key-functions",children:"Key Functions"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"alterState"}),", ",(0,n.jsx)(r.code,{children:"dataValue"}),", ",(0,n.jsx)(r.code,{children:"field"}),", ",(0,n.jsx)(r.code,{children:"fields"}),", ",(0,n.jsx)(r.code,{children:"relationship"}),", ",(0,n.jsx)(r.code,{children:"upsert"})]}),"\n",(0,n.jsx)(r.h2,{id:"expression",children:"Expression"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-js",children:"alterState(state => {\n  function checked(key, str) {\n    if (!str) return false;\n    return str.split(' ').indexOf(key) >= 0;\n  }\n\n  state.helperFunctions = { checked };\n\n  function capitalizeFirstLetter(str) {\n    if (!str) return;\n    let new_str = str.toString().toLowerCase();\n    return new_str.slice(0, 1).toUpperCase() + new_str.slice(1);\n  }\n\n  function transform(value) {\n    if (!value) return;\n    switch (value.toString().trim()) {\n      case 'Daughterson':\n        return 'Daughter/Son';\n      case 'Other_specify':\n        return 'Other';\n      case 'Single_never_married':\n        return 'Single/Never Married';\n      case 'Divorced__separated':\n        return 'Divorced/separated';\n      default:\n        return value;\n    }\n  }\n\n  state.data.form.parent__guardian_information.relationship_to_client = transform(\n    capitalizeFirstLetter(state.data.form.parent__guardian_information.relationship_to_client)\n  );\n\n  return state;\n});\n\nalterState(state => {\n  if (!state.data.form.subcase_0) {\n    console.log('No referral services to upsert');\n    return state;\n  }\n  return upsert(\n    'NewReferral__c',\n    'CommCare_Ext_ID__c',\n    fields(\n      //  field('Enter_Partner_s_Name__c', dataValue('form.referral_information.institution_referred_to')),\n      //  field('Type_of_Referral__c', dataValue('form.referral_information.type_of_referral')),\n      field('Participants_Full_Name__c', dataValue('form.client_registration.participant_full_name')),\n      //field('Parent_Guardian_Contact_Number__c', dataValue('form.client_registration.mobile_number')),\n      relationship('Event__r', 'CommCare_Case_ID__c', dataValue('form.event_name')),\n      field('CommCare_Ext_ID__c', state => {\n        var subid = state.data.form.subcase_0;\n        return subid && subid !== '' ? state.data.form.subcase_0.case['@case_id'] : dataValue('id')(state); //Set external id to 'service' subcase if available, otherwise use formid\n      }),\n      //field('Venue__c', dataValue('form.client_registration.school_name')),\n      //field('Grade__c', dataValue('form.client_registration.grade')),\n      //field('Class__c', dataValue('form.client_registration.class')),\n      field('Parent_Guardian_Full_Name__c', dataValue('form.parent__guardian_information.parent__guardian_full_name')),\n      field('Relationship_To_Client__c', dataValue('form.parent__guardian_information.relationship_to_client')),\n      field('Parent_Guardian_Contact_Number__c', dataValue('form.parent__guardian_information.contact_number')),\n      field('Institution_Referred_To_1__c', dataValue('form.referral_information.institution_referred_to')),\n      field('Institution_Referred_To_2__c', dataValue('form.referral_information.copy-1-of-institution_referred_to')),\n      field('Institution_Referred_To_3__c', dataValue('form.referral_information.copy-2-of-institution_referred_to')),\n      field('Service_Provider_Name__c', dataValue('form.hidden_props.coach_name')),\n      field('HIV_Testing_Services_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'hiv_testing_services',\n          dataValue('form.referral_services.hiv_support__care.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('VMMC_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'vmmc',\n          dataValue('form.referral_services.hiv_support__care.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('TB_Screening_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'tb_screening_treatment_adherence',\n          dataValue('form.referral_services.hiv_support__care.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('Post_Exposure_Prophylaxis_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'post_exposure_prophylaxis',\n          dataValue('form.referral_services.hiv_support__care.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('PrEP_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'prep',\n          dataValue('form.referral_services.hiv_support__care.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('HIV_STI_PREVENTION_Other_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'other',\n          dataValue('form.referral_services.hiv_support__care.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('HIV_Other__c', dataValue('form.referral_services.hiv_support__care.please_specify')),\n      field('ART_Initiation_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'art_initiationenrollment',\n          dataValue('form.referral_services.art_support_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('PMTCT_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'pmtct',\n          dataValue('form.referral_services.art_support_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('SKILLZ_Plus_Club_Support_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'grs_skillz_plus_club',\n          dataValue('form.referral_services.art_support_services.skillz_plus_club_option')(state)\n        )\n      ),\n      field(\n        'Victim_Friendly_Services_GRS_Staff__c',\n        state =>\n          state.helperFunctions.checked(\n            'suspected_abuse_reported_police_court_other_authority',\n            dataValue(\n              'form.referral_services.child_protection_support_services.check_the_services_that_client_was_referred_to'\n            )(state)\n          ) ||\n          state.helperFunctions.checked(\n            'post_violence_care_medical_legal_counseling',\n            dataValue(\n              'form.referral_services.child_protection_support_services.check_the_services_that_client_was_referred_to'\n            )(state)\n          ) ||\n          state.helperFunctions.checked(\n            'child_support_grant_social_foster_general_support',\n            dataValue(\n              'form.referral_services.child_protection_support_services.check_the_services_that_client_was_referred_to'\n            )(state)\n          ) ||\n          state.helperFunctions.checked(\n            'other',\n            dataValue(\n              'form.referral_services.child_protection_support_services.check_the_services_that_client_was_referred_to'\n            )(state)\n          )\n      ),\n      field('Business_Unit_Site__c', state => {\n        const bu = dataValue('form.business_unit')(state);\n        return bu === '65680f0c4c144b03ad0f86bdc46c1ebc'\n          ? 'GRS Zambia'\n          : bu === '04d98397e28046118fade28ced6b65cb'\n          ? 'GRS Zimbabwe'\n          : bu === 'ed125ab19ec34aacab79585e59eb76f4'\n          ? 'GRS Partnerships'\n          : undefined;\n      }),\n      field(\n        'Sexual_and_GBV_Abuse_GRS_Staff__c',\n        dataValue('form.referral_services.child_protection_support_services.abuse_reported_to')\n      ),\n\n      field('Legal_Other__c', dataValue('form.referral_services.legal_services.please_specify_other_legal')),\n      field(\n        'Legal_Services_Other_GRS_Staff__c',\n        state =>\n          state.helperFunctions.checked(\n            'other',\n            dataValue('form.referral_services.legal_services.legal_services')(state)\n          ) ||\n          state.helperFunctions.checked(\n            'id',\n            dataValue('form.referral_services.legal_services.legal_services')(state)\n          ) ||\n          state.helperFunctions.checked(\n            'birth_bertificate',\n            dataValue('form.referral_services.legal_services.legal_services')(state)\n          )\n      ),\n      field('STI_Screen_Testing_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'sti_screening_diagnosis_treatment',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('Contraception_Family_Plan_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'contraceptivesfamily_planning',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('Cervical_Cancer_Screening_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'cervical_cancer_screening',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('HPV_vaccine_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'hpv',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('Antenatal_Care_ANC_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'antenatal_care_anc',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('Sexual_and_GBV_Abuse_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'based_violenceabus',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field(\n        'Psycho_Social_Support_GRS_Staff__c',\n        state =>\n          state.helperFunctions.checked(\n            'drug_or_alcohol_abuse',\n            dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(\n              state\n            )\n          ) ||\n          state.helperFunctions.checked(\n            'psychiatric_careintensive_counseling',\n            dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(\n              state\n            )\n          ) ||\n          state.helperFunctions.checked(\n            'psychosocial_support',\n            dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(\n              state\n            )\n          )\n      ),\n      field('Psycho_Social_Services_Other_GRS_Staff__c', state =>\n        state.helperFunctions.checked(\n          'other',\n          dataValue('form.referral_services.other_srhr_services.check_the_services_that_client_was_referred_to')(state)\n        )\n      ),\n      field('Psycho_Other__c', dataValue('form.referral_services.other_srhr_services.please_specify_srhr_referred')),\n      field('Date_Referred__c', dataValue('form.follow-up.date_referred')),\n      field('Expected_Visit_Date__c', dataValue('form.follow-up.expected_visit_date')),\n      field('Client_Follow_up_Consent_given__c', state =>\n        state.helperFunctions.checked('client_follow-up_consent_given', dataValue('form.follow-up.select')(state))\n      ),\n      field('Client_Linked_to_care__c', state =>\n        state.helperFunctions.checked('client_linked_to_care', dataValue('form.follow-up.select')(state))\n      )\n    )\n  )(state);\n});\n\n"})})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}}}]);