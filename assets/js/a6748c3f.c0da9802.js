"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[61611],{28453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>o});var n=a(96540);const _={},r=n.createContext(_);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(_):e.components||_:s(e.components),n.createElement(r.Provider,{value:t},e.children)}},87940:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"library/jobs/auto/Upsert-Coach-Support-Visit-CSV-2021-04-28","title":"Upsert Coach Support Visit CSV","description":"This job was provided by an OpenFn.org user via the job library API.","source":"@site/adaptors/library/jobs/auto/Upsert-Coach-Support-Visit-CSV-2021-04-28.md","sourceDirName":"library/jobs/auto","slug":"/library/jobs/auto/Upsert-Coach-Support-Visit-CSV-2021-04-28","permalink":"/adaptors/library/jobs/auto/Upsert-Coach-Support-Visit-CSV-2021-04-28","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Upsert Coach Support Visit CSV","sidebar_label":"Upsert Coach Support Visit CSV","id":"Upsert-Coach-Support-Visit-CSV-2021-04-28","keywords":["library","job","expression","salesforce","alterState","dataValue","field","fields","join","map","relationship","upsert"]},"sidebar":"adaptors","previous":{"title":"Upsert Confirm Services Received","permalink":"/adaptors/library/jobs/auto/Upsert-Confirm-Services-Received-2021-06-14"},"next":{"title":"Upsert Attendance Skillz Plus Club","permalink":"/adaptors/library/jobs/auto/Upsert-Attendance-Skillz-Plus-Club-2021-05-24"}}');var _=a(74848),r=a(28453);const s={title:"Upsert Coach Support Visit CSV",sidebar_label:"Upsert Coach Support Visit CSV",id:"Upsert-Coach-Support-Visit-CSV-2021-04-28",keywords:["library","job","expression","salesforce","alterState","dataValue","field","fields","join","map","relationship","upsert"]},o=void 0,i={},c=[{value:"Metadata",id:"metadata",level:2},{value:"Key Functions",id:"key-functions",level:2},{value:"Expression",id:"expression",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("em",{children:"This job was provided by an OpenFn.org user via the job library API."}),"\n",(0,_.jsx)(t.h2,{id:"metadata",children:"Metadata"}),"\n",(0,_.jsxs)(t.ul,{children:["\n",(0,_.jsx)(t.li,{children:"Name: Upsert Coach Support Visit CSV"}),"\n",(0,_.jsxs)(t.li,{children:["Adaptor: ",(0,_.jsx)(t.a,{href:"https://www.github.com/openfn/language-salesforce",children:(0,_.jsx)(t.code,{children:"@openfn/language-salesforce"})})]}),"\n",(0,_.jsxs)(t.li,{children:["Adaptor Version: ",(0,_.jsx)(t.a,{href:"https://www.github.com/openfn/language-salesforce/releases/tag/v2.7.4",children:(0,_.jsx)(t.code,{children:"v2.7.4"})})]}),"\n",(0,_.jsx)(t.li,{children:"Created about 4 years ago"}),"\n",(0,_.jsx)(t.li,{children:"Updated 4 months ago"}),"\n",(0,_.jsxs)(t.li,{children:["Score: ",(0,_.jsx)("b",{children:"0"})," (an ",(0,_.jsx)(t.a,{href:"/adaptors/library/#library-scores",children:"indicator"})," of how useful this job may be)"]}),"\n"]}),"\n",(0,_.jsx)(t.h2,{id:"key-functions",children:"Key Functions"}),"\n",(0,_.jsxs)(t.p,{children:[(0,_.jsx)(t.code,{children:"alterState"}),", ",(0,_.jsx)(t.code,{children:"dataValue"}),", ",(0,_.jsx)(t.code,{children:"field"}),", ",(0,_.jsx)(t.code,{children:"fields"}),", ",(0,_.jsx)(t.code,{children:"join"}),", ",(0,_.jsx)(t.code,{children:"map"}),", ",(0,_.jsx)(t.code,{children:"relationship"}),", ",(0,_.jsx)(t.code,{children:"upsert"})]}),"\n",(0,_.jsx)(t.h2,{id:"expression",children:"Expression"}),"\n",(0,_.jsx)(t.pre,{children:(0,_.jsx)(t.code,{className:"language-js",children:"//openfn.org source\nalterState(state => {\n  function clean(str) {\n    console.log('str', str);\n\n    if (!str) return '';\n\n    return str\n      .split('_')\n      .map(word => {\n        let new_word = word.toString().toLowerCase();\n        return new_word.slice(0, 1).toUpperCase() + new_word.slice(1);\n      })\n      .join(' ');\n  }\n \n  if (state.data.form['step_3_-_the_big_5']  !== undefined ){ \n    state.data.form['step_3_-_the_big_5'].faciliation = clean(state.data.form['step_3_-_the_big_5'].faciliation);\n  }\n  else{\n  state.data.form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.faciliation = \n  clean(state.data.form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.faciliation);\n  }\n  \n  function transform(value) {\n    if (!value) return;\n    switch (value.toString().trim()) {\n      case 'copy-1-of-excellent':\n        return 'Excellent'; \n      case 'needs_improvement':\n        return 'Needs Improvement';      \n      case 'meets_expectations':\n        return 'Meets Expectations'; \n      case 'excellent':\n        return 'Excellent';        \n      case 'unsatisfactory':\n        return 'Unsatisfactory';\n      case 'exceeds_expectations':\n        return 'Exceeds Expectations';        \n      default:\n        return value;\n    }\n  }\n\n  state.data.form['step_3_-_the_big_5'].builds_personal_connections = \n  transform(state.data.form['step_3_-_the_big_5'].builds_personal_connections)\n\n  state.data.form['step_3_-_the_big_5'].cool_down = \n  transform(state.data.form['step_3_-_the_big_5'].cool_down)\n  \n  state.data.form['step_3_-_the_big_5'].creates_safe_space = \n  transform(state.data.form['step_3_-_the_big_5'].creates_safe_space)\n  \n  state.data.form['step_3_-_the_big_5'].faciliation = \n  transform(state.data.form['step_3_-_the_big_5'].faciliation)\n  \n  state.data.form['step_3_-_the_big_5'].gives_praise = \n  transform(state.data.form['step_3_-_the_big_5'].gives_praise)\n  \n  state.data.form['step_3_-_the_big_5'].praise = \n  transform(state.data.form['step_3_-_the_big_5'].praise)\n\n  state.data.form['step_3_-_the_big_5'].preparation = \n  transform(state.data.form['step_3_-_the_big_5'].preparation)\n  \n  state.data.form['step_3_-_the_big_5'].shares_accurate_information_about_hivaids_sexual_reproductive_health_and_ri = \n  transform(state.data.form['step_3_-_the_big_5'].shares_accurate_information_about_hivaids_sexual_reproductive_health_and_ri)\n  \n  state.data.form['step_3_-_the_big_5'].sparks_vital_conversations = \n  transform(state.data.form['step_3_-_the_big_5'].sparks_vital_conversations)\n  \n  state.data.form['step_3_-_the_big_5'].time_management = \n  transform(state.data.form['step_3_-_the_big_5'].time_management)\n  \n   state.data.form['step_3_-_the_big_5'].warm_up = \n  transform(state.data.form['step_3_-_the_big_5'].warm_up)\n  \n\n  return state;\n});\n\nupsert(\n  'Coach_Support_Visit__c',\n  'CommCare_Ext_ID__c',\n  fields(\n    field('CommCare_Ext_ID__c', dataValue('id')),\n    relationship('Coach_Person__r', 'CommCare_Ext_ID__c', state => {\n      return dataValue('form.step_1_basic_information.select_coach')(state) || \n      dataValue('form.step_1_csv_information.select_coach')(state); \n    }),\n    relationship('Venue__r', 'CommCare_Ext_ID__c', state => {\n      return dataValue('form.hidden_properties.venue')(state) || \n      dataValue('form.step_1_csv_information.venue')(state); \n    }),\n    relationship('Event__r', 'CommCare_Ext_ID__c', state => {\n      return dataValue('form.hidden_properties.intervention')(state) || \n      dataValue('form.step_1_csv_information.intervention')(state); \n    }),\n    relationship('Curriculum_Aggregate__r', 'CommCare_Ext_ID__c', state => {\n      return dataValue('form.hidden_properties.curriculum')(state) || \n      dataValue('form.step_1_csv_information.curriculum')(state); \n    }),    \n     relationship('Site_Lookup__r', 'CommCare_Ext_ID__c', state => {\n      return dataValue('form.hidden_properties.site')(state) || \n      dataValue('form.step_1_csv_information.site')(state); \n    }), \n    field('Date__c', dataValue('form.step_2_practice_information.date_of_csv')),\n    //== TODO: FIx repeated mappings to only reference destination field 1 time ===//\n    field(\n      'Accurate_Information__c', state => {\n      return dataValue('form.step_3_-_the_big_5.shares_accurate_information_about_hivaids_sexual_reproductive_health_and_ri')(state) || \n      dataValue(\n          'form.step_3_the_big_five.question1.shares_accurate_information_about_hivaids_sexual_reproductive_health_and_ri'\n        )(state); \n    }),\n    field('Creates_safe_space__c', state => {\n      return dataValue('form.step_3_-_the_big_5.creates_safe_space')(state) || \n      dataValue('form.step_3_the_big_five.question1.creates_safe_space')(state); \n      \n    }),\n    field('Builds_personal_connections__c', state => {\n      return dataValue('form.step_3_-_the_big_5.builds_personal_connections')(state) || \n      dataValue('form.step_3_the_big_five.question1.builds_personal_connections')(state); \n    }),\n    field('Gives_praise__c', state => {\n      return dataValue('form.step_3_-_the_big_5.gives_praise')(state) ||\n      dataValue('form.step_3_the_big_five.question1.gives_powerful_praise')(state); \n    }),\n    field('Sparks_vital_conversations__c', state => {\n      return dataValue('form.step_3_-_the_big_5.sparks_vital_conversations')(state) || \n      dataValue('form.step_3_the_big_five.question1.sparks_vital_conversations')(state); \n      }),\n    field('X2_Warm_Up__c', state => {\n      return dataValue('form.step_3_-_the_big_5.warm_up')(state) || \n      dataValue(\n          'form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.warm_up'\n        )(state); \n      }),\n    field('X3_Activity__c', state => {\n      return dataValue('form.step_3_-_the_big_5.activity')(state) || dataValue(\n          'form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.activity'\n        )(state); \n      }),\n    field('X4_Cool_Down__c', state => {\n      return dataValue('form.step_3_-_the_big_5.cool_down')(state) || dataValue(\n          'form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.cool_down'\n        )(state); \n      }),\n    field('X5_Facilitation__c', state => {\n      return dataValue('form.step_3_-_the_big_5.faciliation')(state) || \n      dataValue(\n          'form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.faciliation'\n        )(state); \n      }),\n    field(\n      'X6_Time_Management__c',\n      dataValue('form.step_3_-_the_big_5.time_management')\n    ),\n    field(\n      'X1_Preparation__c',\n      dataValue('form.step_3_-_the_big_5.preparation')\n    ),\n    field('Introduces_micromove__c', state => {\n      return //dataValue('form.step_3_-_the_big_5.faciliation')(state) || \n      dataValue(\n         'form.step_4_comments.for_each_practice_component_describe_what_the_coach_did_well_and_how_the_co.micromove'\n      )(state); \n    }),\n    field(\n      'Notes__c',\n      dataValue(\n        'form.step_3_-_the_big_5.additional_notes.include_your_obsevations_related_to_preparation_punctuality_process'\n      )\n    )\n  )\n);\n\n"})})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,_.jsx)(t,{...e,children:(0,_.jsx)(l,{...e})}):l(e)}}}]);