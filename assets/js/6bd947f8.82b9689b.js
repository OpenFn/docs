"use strict";(self.webpackChunk_openfn_docs=self.webpackChunk_openfn_docs||[]).push([[77019],{7112:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"jobs/image-handling","title":"Handling Images","description":"OpenFn jobs run in Javascript, and most commonly we\'re handling JSON data from","source":"@site/docs/jobs/image-handling.md","sourceDirName":"jobs","slug":"/jobs/image-handling","permalink":"/documentation/jobs/image-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/openfn/docs/edit/main/docs/jobs/image-handling.md","tags":[],"version":"current","frontMatter":{"title":"Handling Images"},"sidebar":"docs","previous":{"title":"Code Snippets","permalink":"/documentation/jobs/job-snippets"},"next":{"title":"Security considerations","permalink":"/documentation/security-for-devs"}}');var o=t(74848),a=t(28453);const i={title:"Handling Images"},r=void 0,d={},c=[{value:"Base64 (standard handling)",id:"base64-standard-handling",level:2},{value:"Adaptor Native Support",id:"adaptor-native-support",level:2},{value:"Working with Buffers",id:"working-with-buffers",level:2},{value:"Summary",id:"summary",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"OpenFn jobs run in Javascript, and most commonly we're handling JSON data from\nREST APIs or webhooks. We receive JSON, manipulate it with Javascript, then send\nJSON to some other REST API. Sometimes, however, you need to work with images or\nother binaries. This page explains how you do it."}),"\n",(0,o.jsx)(n.admonition,{title:"The tl;dr:",type:"success",children:(0,o.jsxs)(n.p,{children:["Images and other binaries mostly ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:"Just Work\u2122\ufe0f"})}),". Edges cases might\nneed additions to adaptors."]})}),"\n",(0,o.jsx)(n.h2,{id:"base64-standard-handling",children:"Base64 (standard handling)"}),"\n",(0,o.jsxs)(n.p,{children:["In essence, the way to deal with images/PDFs/other files and be able to save\nthem to ",(0,o.jsx)(n.code,{children:"state"})," and pass them from step to step in an OpenFn workflow is to\nencode them as base64 and then turn them back into Buffers before sending them\nto a downstream system's API."]}),"\n",(0,o.jsx)(n.p,{children:"The HTTP adaptor already contains everything you need to do this. Check out:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsxs)(n.a,{href:"https://docs.openfn.org/adaptors/packages/http-docs#requestoptions",children:["Request Options (",(0,o.jsx)(n.code,{children:"parseAs"}),")"]})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://docs.openfn.org/adaptors/packages/http-docs#util_encode",children:"Encode"})," a\ngiven string into Base64 format."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://docs.openfn.org/adaptors/packages/http-docs#util_decode",children:"Decode"})," a\nBase64 encoded string back to its original format."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"adaptor-native-support",children:"Adaptor Native Support"}),"\n",(0,o.jsx)(n.p,{children:"Some adaptors (DHIS2, FHIR-4, Sunbird-RC) have built in binary handling for\nknown image/file endpoints. When you request a file (and image, a PDF, etc.) the\nresponse will be automatically converted to a base64 encoded string."}),"\n",(0,o.jsx)(n.h2,{id:"working-with-buffers",children:"Working with Buffers"}),"\n",(0,o.jsx)(n.p,{children:"You can also work directly with buffers in OpenFn job code via code like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"fn(state => {\n  const encoded = Buffer.from(state.data.myBase64string, 'base64');\n  return { ...state, encodedImage };\n});\n"})}),"\n",(0,o.jsx)(n.p,{children:"or..."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"fn(state => {\n  const decoded = state.data.myBuffer.toString('base64');\n  return { ...state, decoded };\n});\n"})}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsxs)(n.p,{children:["Most use cases should ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.em,{children:"Just Work \u2122\ufe0f"})}),". If you have a specific need involving\nlarge file sizes or high volumes and you need to process images, rather than\njust moving them from place to place, you might need to make a change to your\nadaptor."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>r});var s=t(96540);const o={},a=s.createContext(o);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);